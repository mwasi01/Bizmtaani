<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Suite Pro 2.0 - Complete Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #17a2b8;
            --light-bg: #f8f9fa;
            --dark-bg: #2c3e50;
            --card-shadow: 0 4px 12px rgba(0,0,0,0.1);
            --sidebar-width: 260px;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .sidebar {
            background: linear-gradient(180deg, var(--primary-color) 0%, #1a2530 100%);
            color: white;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            width: var(--sidebar-width);
            padding-top: 20px;
            box-shadow: 3px 0 15px rgba(0,0,0,0.15);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .main-content {
            margin-left: var(--sidebar-width);
            padding: 25px;
            min-height: 100vh;
        }
        
        .nav-link {
            color: rgba(255,255,255,0.85);
            padding: 14px 20px;
            margin: 6px 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .nav-link:hover, .nav-link.active {
            background: rgba(255,255,255,0.15);
            color: white;
            text-decoration: none;
            transform: translateX(5px);
        }
        
        .nav-link i {
            font-size: 1.1rem;
            width: 24px;
            text-align: center;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            border: none;
            position: relative;
            overflow: hidden;
        }
        
        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--secondary-color);
        }
        
        .dashboard-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .card-title {
            color: var(--primary-color);
            font-weight: 700;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .stat-number {
            font-size: 2.8rem;
            font-weight: 800;
            color: var(--secondary-color);
            line-height: 1;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--secondary-color) 0%, #2980b9 100%);
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success-color) 0%, #219653 100%);
            border: none;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color) 0%, #e67e22 100%);
            border: none;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color) 0%, #c0392b 100%);
            border: none;
        }
        
        .table-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--card-shadow);
        }
        
        .table th {
            background: linear-gradient(180deg, var(--light-bg) 0%, #e9ecef 100%);
            border: none;
            font-weight: 700;
            color: var(--primary-color);
            padding: 15px;
            border-bottom: 2px solid var(--secondary-color);
        }
        
        .table td {
            vertical-align: middle;
            padding: 15px;
            border-color: #eee;
        }
        
        .badge {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .badge-low {
            background: linear-gradient(135deg, #fee 0%, #fdd 100%);
            color: var(--danger-color);
            border: 1px solid #fcc;
        }
        
        .badge-ok {
            background: linear-gradient(135deg, #efe 0%, #dfd 100%);
            color: var(--success-color);
            border: 1px solid #cfc;
        }
        
        .badge-customer {
            background: linear-gradient(135deg, #e8f4fc 0%, #d4e9fa 100%);
            color: var(--secondary-color);
            border: 1px solid #b8d4f0;
        }
        
        .modal-content {
            border-radius: 15px;
            border: none;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .form-control, .form-select {
            border-radius: 10px;
            padding: 12px 18px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
            transform: translateY(-2px);
        }
        
        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar .nav-text {
                display: none;
            }
            
            .main-content {
                margin-left: 70px;
            }
            
            .nav-link {
                text-align: center;
                padding: 15px 5px;
                justify-content: center;
            }
            
            .nav-link i {
                font-size: 1.3rem;
            }
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            height: 400px;
        }
        
        .customer-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--card-shadow);
            border-left: 5px solid var(--info-color);
            transition: all 0.3s;
        }
        
        .customer-card:hover {
            transform: translateY(-5px);
        }
        
        .note-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--card-shadow);
            border-left: 5px solid var(--warning-color);
            transition: all 0.3s;
        }
        
        .note-card:hover {
            transform: translateY(-5px);
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .search-box {
            position: relative;
        }
        
        .search-box input {
            padding-left: 45px;
            border-radius: 25px;
            border: 2px solid #e0e0e0;
        }
        
        .search-box i {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            z-index: 10;
        }
        
        .alert-box {
            position: fixed;
            top: 25px;
            right: 25px;
            z-index: 9999;
            min-width: 300px;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .progress-ring {
            width: 120px;
            height: 120px;
        }
        
        .progress-ring-circle {
            stroke: var(--secondary-color);
            stroke-width: 8;
            stroke-linecap: round;
            fill: none;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dashoffset 0.5s;
        }
        
        .avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--secondary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-active {
            background-color: var(--success-color);
            box-shadow: 0 0 8px var(--success-color);
        }
        
        .status-inactive {
            background-color: #95a5a6;
        }
        
        .dropdown-action {
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 8px;
        }
        
        .dropdown-action:hover {
            background-color: var(--light-bg);
        }
        
        .section-header {
            border-bottom: 3px solid var(--secondary-color);
            padding-bottom: 15px;
            margin-bottom: 25px;
        }
        
        .supplier-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1rem;
        }
        
        .product-tag {
            display: inline-block;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #dee2e6;
            border-radius: 20px;
            padding: 4px 12px;
            margin: 2px;
            font-size: 0.85rem;
            color: #495057;
        }
        
        .product-tag:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            cursor: pointer;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-state h5 {
            margin-bottom: 10px;
            color: #495057;
        }
        
        .empty-state p {
            max-width: 500px;
            margin: 0 auto 25px;
            line-height: 1.6;
        }
        
        .danger-zone {
            border: 2px solid #e74c3c;
            border-radius: 10px;
            padding: 20px;
            background: linear-gradient(135deg, #fff5f5 0%, #ffeaea 100%);
        }
        
        .warning-zone {
            border: 2px solid #f39c12;
            border-radius: 10px;
            padding: 20px;
            background: linear-gradient(135deg, #fff9e6 0%, #fff4d4 100%);
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="text-center mb-4">
            <div class="avatar mx-auto mb-3" style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--secondary-color) 0%, #2980b9 100%);">
                <i class="fas fa-chart-line"></i>
            </div>
            <h4 class="mb-1"><span class="nav-text">Business Suite Pro 2.0</span></h4>
            <small class="text-muted">Complete Management System</small>
        </div>
        
        <nav class="nav flex-column">
            <a class="nav-link active" href="#" onclick="showSection('dashboard')">
                <i class="fas fa-tachometer-alt"></i>
                <span class="nav-text">Dashboard</span>
            </a>
            <a class="nav-link" href="#" onclick="showSection('products')">
                <i class="fas fa-boxes"></i>
                <span class="nav-text">Products</span>
            </a>
            <a class="nav-link" href="#" onclick="showSection('customers')">
                <i class="fas fa-users"></i>
                <span class="nav-text">Customers</span>
                <span class="badge bg-success ms-auto" id="customer-count">0</span>
            </a>
            <a class="nav-link" href="#" onclick="showSection('transactions')">
                <i class="fas fa-exchange-alt"></i>
                <span class="nav-text">Transactions</span>
            </a>
            <a class="nav-link" href="#" onclick="showSection('suppliers')">
                <i class="fas fa-truck"></i>
                <span class="nav-text">Suppliers</span>
                <span class="badge bg-warning ms-auto" id="supplier-count">0</span>
            </a>
            <a class="nav-link" href="#" onclick="showSection('analytics')">
                <i class="fas fa-chart-bar"></i>
                <span class="nav-text">Analytics</span>
            </a>
            <a class="nav-link" href="#" onclick="showSection('reports')">
                <i class="fas fa-file-alt"></i>
                <span class="nav-text">Reports</span>
            </a>
            <a class="nav-link" href="#" onclick="showSection('notes')">
                <i class="fas fa-sticky-note"></i>
                <span class="nav-text">Notes</span>
            </a>
            <a class="nav-link" href="#" onclick="showSection('settings')">
                <i class="fas fa-cog"></i>
                <span class="nav-text">Settings</span>
            </a>
        </nav>
        
        <div class="mt-auto p-3">
            <div class="text-center">
                <div class="d-grid gap-2">
                    <button class="btn btn-outline-light btn-sm" onclick="exportData()">
                        <i class="fas fa-download"></i>
                        <span class="nav-text">Export Data</span>
                    </button>
                    <button class="btn btn-outline-light btn-sm" onclick="backupData()">
                        <i class="fas fa-save"></i>
                        <span class="nav-text">Backup</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard Section -->
        <div id="dashboard-section">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="mb-1">Dashboard Overview</h2>
                    <p class="text-muted mb-0">Welcome! Add your business data to get started.</p>
                </div>
                <div class="d-flex gap-3">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" class="form-control" placeholder="Search anything..." style="width: 300px;">
                    </div>
                    <button class="btn btn-primary" onclick="refreshDashboard()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            
            <!-- Stats Cards -->
            <div class="row mb-4">
                <div class="col-xl-3 col-md-6">
                    <div class="dashboard-card">
                        <div class="stat-number" id="total-sales">KES 0</div>
                        <div class="stat-label">Total Sales</div>
                        <small class="text-muted">Last 30 days</small>
                        <i class="fas fa-shopping-cart position-absolute" style="bottom: 20px; right: 20px; font-size: 2rem; opacity: 0.1;"></i>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6">
                    <div class="dashboard-card">
                        <div class="stat-number" id="total-products">0</div>
                        <div class="stat-label">Active Products</div>
                        <small class="text-muted">In stock</small>
                        <i class="fas fa-box position-absolute" style="bottom: 20px; right: 20px; font-size: 2rem; opacity: 0.1;"></i>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6">
                    <div class="dashboard-card">
                        <div class="stat-number" id="total-customers">0</div>
                        <div class="stat-label">Customers</div>
                        <small class="text-muted">Active clients</small>
                        <i class="fas fa-users position-absolute" style="bottom: 20px; right: 20px; font-size: 2rem; opacity: 0.1;"></i>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6">
                    <div class="dashboard-card">
                        <div class="stat-number" id="total-suppliers">0</div>
                        <div class="stat-label">Active Suppliers</div>
                        <small class="text-muted">Business partners</small>
                        <i class="fas fa-truck position-absolute" style="bottom: 20px; right: 20px; font-size: 2rem; opacity: 0.1;"></i>
                    </div>
                </div>
            </div>
            
            <!-- Charts and Quick Stats -->
            <div class="row mb-4">
                <div class="col-lg-8">
                    <div class="chart-container">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0">Sales Performance</h5>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-secondary active" onclick="changeChartPeriod('week')">Week</button>
                                <button class="btn btn-outline-secondary" onclick="changeChartPeriod('month')">Month</button>
                                <button class="btn btn-outline-secondary" onclick="changeChartPeriod('quarter')">Quarter</button>
                            </div>
                        </div>
                        <div id="salesChartPlaceholder" class="empty-state">
                            <i class="fas fa-chart-line"></i>
                            <h5>No Sales Data Yet</h5>
                            <p>Add transactions to see sales performance charts</p>
                            <button class="btn btn-primary" onclick="showAddTransactionModal()">
                                <i class="fas fa-plus"></i> Add First Transaction
                            </button>
                        </div>
                        <canvas id="salesChart" style="display: none;"></canvas>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="dashboard-card h-100">
                        <h5>Quick Stats</h5>
                        <div id="quick-stats" class="mt-4">
                            <div class="empty-state" style="padding: 20px 0;">
                                <i class="fas fa-chart-pie" style="font-size: 2.5rem;"></i>
                                <p>Add business data to see statistics</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Recent Activity -->
            <div class="row">
                <div class="col-lg-6">
                    <div class="table-container">
                        <h5 class="mb-3">Recent Transactions</h5>
                        <div id="recent-transactions-placeholder" class="empty-state" style="padding: 30px 20px;">
                            <i class="fas fa-exchange-alt"></i>
                            <h5>No Transactions Yet</h5>
                            <p>Start by adding your first transaction</p>
                            <button class="btn btn-primary mt-2" onclick="showAddTransactionModal()">
                                <i class="fas fa-plus"></i> Add First Transaction
                            </button>
                        </div>
                        <div class="table-responsive" id="recent-transactions-container" style="display: none;">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Customer</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-transactions">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="dashboard-card">
                        <h5 class="mb-3">Top Customers</h5>
                        <div id="top-customers-placeholder" class="empty-state" style="padding: 30px 20px;">
                            <i class="fas fa-users"></i>
                            <h5>No Customers Yet</h5>
                            <p>Add customers to see top performers</p>
                            <button class="btn btn-primary mt-2" onclick="showAddCustomerModal()">
                                <i class="fas fa-user-plus"></i> Add First Customer
                            </button>
                        </div>
                        <div id="top-customers" style="display: none;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Products Section -->
        <div id="products-section" style="display: none;">
            <div class="section-header">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="mb-0">Product Management</h2>
                        <p class="text-muted mb-0">Manage your inventory and product catalog</p>
                    </div>
                    <div>
                        <button class="btn btn-primary me-2" onclick="showAddProductModal()">
                            <i class="fas fa-plus"></i> Add Product
                        </button>
                        <button class="btn btn-success" onclick="exportProducts()">
                            <i class="fas fa-file-export"></i> Export
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="table-container">
                <div class="d-flex justify-content-between mb-4">
                    <div class="search-box" style="width: 400px;">
                        <i class="fas fa-search"></i>
                        <input type="text" class="form-control" id="productSearch" placeholder="Search products by name, category, or SKU..." onkeyup="searchProducts()">
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary active" onclick="filterProducts('all')">All</button>
                        <button class="btn btn-outline-warning" onclick="filterProducts('low')">Low Stock</button>
                        <button class="btn btn-outline-danger" onclick="filterProducts('out')">Out of Stock</button>
                        <button class="btn btn-outline-success" onclick="filterProducts('active')">Active</button>
                    </div>
                </div>
                
                <div id="products-empty-state" class="empty-state">
                    <i class="fas fa-boxes"></i>
                    <h5>No Products Yet</h5>
                    <p>Add your products to start managing inventory. Track stock levels, prices, and supplier information.</p>
                    <button class="btn btn-primary" onclick="showAddProductModal()">
                        <i class="fas fa-plus"></i> Add First Product
                    </button>
                </div>
                
                <div class="table-responsive" id="products-table-container" style="display: none;">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>SKU</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Cost</th>
                                <th>Stock</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="products-table">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Customers Section -->
        <div id="customers-section" style="display: none;">
            <div class="section-header">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="mb-0">Customer Management</h2>
                        <p class="text-muted mb-0">Manage your customer relationships and orders</p>
                    </div>
                    <div>
                        <button class="btn btn-primary me-2" onclick="showAddCustomerModal()">
                            <i class="fas fa-user-plus"></i> Add Customer
                        </button>
                        <button class="btn btn-success" onclick="exportCustomers()">
                            <i class="fas fa-file-export"></i> Export
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Customer Stats -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="dashboard-card text-center">
                        <div class="stat-number" id="total-active-customers">0</div>
                        <div class="stat-label">Active Customers</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="dashboard-card text-center">
                        <div class="stat-number" id="customer-growth">0%</div>
                        <div class="stat-label">Growth Rate</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="dashboard-card text-center">
                        <div class="stat-number" id="avg-order-value">KES 0</div>
                        <div class="stat-label">Avg Order Value</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="dashboard-card text-center">
                        <div class="stat-number" id="repeat-rate">0%</div>
                        <div class="stat-label">Repeat Rate</div>
                    </div>
                </div>
            </div>
            
            <div class="table-container">
                <div class="d-flex justify-content-between mb-4">
                    <div class="search-box" style="width: 400px;">
                        <i class="fas fa-search"></i>
                        <input type="text" class="form-control" id="customerSearch" placeholder="Search customers by name, email, or phone..." onkeyup="searchCustomers()">
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary active" onclick="filterCustomers('all')">All</button>
                        <button class="btn btn-outline-success" onclick="filterCustomers('active')">Active</button>
                        <button class="btn btn-outline-warning" onclick="filterCustomers('inactive')">Inactive</button>
                        <button class="btn btn-outline-info" onclick="filterCustomers('vip')">VIP</button>
                    </div>
                </div>
                
                <div id="customers-empty-state" class="empty-state">
                    <i class="fas fa-users"></i>
                    <h5>No Customers Yet</h5>
                    <p>Add your customers to track orders, manage relationships, and analyze purchasing patterns.</p>
                    <button class="btn btn-primary" onclick="showAddCustomerModal()">
                        <i class="fas fa-user-plus"></i> Add First Customer
                    </button>
                </div>
                
                <div class="table-responsive" id="customers-table-container" style="display: none;">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Customer</th>
                                <th>Contact</th>
                                <th>Total Orders</th>
                                <th>Total Spent</th>
                                <th>Last Order</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="customers-table">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Transactions Section -->
        <div id="transactions-section" style="display: none;">
            <div class="section-header">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="mb-0">Transaction Ledger</h2>
                        <p class="text-muted mb-0">View and manage all financial transactions</p>
                    </div>
                    <div>
                        <button class="btn btn-primary me-2" onclick="showAddTransactionModal()">
                            <i class="fas fa-plus"></i> New Transaction
                        </button>
                        <button class="btn btn-success" onclick="exportTransactions()">
                            <i class="fas fa-file-export"></i> Export
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="table-container">
                <div class="d-flex justify-content-between mb-4">
                    <div class="search-box" style="width: 400px;">
                        <i class="fas fa-search"></i>
                        <input type="text" class="form-control" id="transactionSearch" placeholder="Search transactions..." onkeyup="searchTransactions()">
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary active" onclick="filterTransactions('all')">All</button>
                        <button class="btn btn-outline-success" onclick="filterTransactions('sale')">Sales</button>
                        <button class="btn btn-outline-warning" onclick="filterTransactions('purchase')">Purchases</button>
                        <button class="btn btn-outline-danger" onclick="filterTransactions('refund')">Refunds</button>
                    </div>
                </div>
                
                <div id="transactions-empty-state" class="empty-state">
                    <i class="fas fa-exchange-alt"></i>
                    <h5>No Transactions Yet</h5>
                    <p>Record sales, purchases, and other financial transactions to track your business performance.</p>
                    <button class="btn btn-primary" onclick="showAddTransactionModal()">
                        <i class="fas fa-plus"></i> Add First Transaction
                    </button>
                </div>
                
                <div class="table-responsive" id="transactions-table-container" style="display: none;">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Amount</th>
                                <th>Customer/Supplier</th>
                                <th>Items</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="transactions-table">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Suppliers Section -->
        <div id="suppliers-section" style="display: none;">
            <div class="section-header">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="mb-0">Supplier Management</h2>
                        <p class="text-muted mb-0">Manage your suppliers and purchase orders</p>
                    </div>
                    <div>
                        <button class="btn btn-primary me-2" onclick="showAddSupplierModal()">
                            <i class="fas fa-plus"></i> Add Supplier
                        </button>
                        <button class="btn btn-success" onclick="exportSuppliers()">
                            <i class="fas fa-file-export"></i> Export
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Supplier Stats -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="dashboard-card text-center">
                        <div class="stat-number" id="total-active-suppliers">0</div>
                        <div class="stat-label">Active Suppliers</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="dashboard-card text-center">
                        <div class="stat-number" id="total-products-supplied">0</div>
                        <div class="stat-label">Products Supplied</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="dashboard-card text-center">
                        <div class="stat-number" id="total-purchases">KES 0</div>
                        <div class="stat-label">Total Purchases</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="dashboard-card text-center">
                        <div class="stat-number" id="avg-delivery-time">0</div>
                        <div class="stat-label">Avg Delivery Days</div>
                    </div>
                </div>
            </div>
            
            <div class="table-container">
                <div class="d-flex justify-content-between mb-4">
                    <div class="search-box" style="width: 400px;">
                        <i class="fas fa-search"></i>
                        <input type="text" class="form-control" id="supplierSearch" placeholder="Search suppliers by name, contact, or products..." onkeyup="searchSuppliers()">
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary active" onclick="filterSuppliers('all')">All</button>
                        <button class="btn btn-outline-success" onclick="filterSuppliers('active')">Active</button>
                        <button class="btn btn-outline-warning" onclick="filterSuppliers('inactive')">Inactive</button>
                        <button class="btn btn-outline-info" onclick="filterSuppliers('preferred')">Preferred</button>
                    </div>
                </div>
                
                <div id="suppliers-empty-state" class="empty-state">
                    <i class="fas fa-truck"></i>
                    <h5>No Suppliers Yet</h5>
                    <p>Add your suppliers to manage purchase orders, track deliveries, and maintain supplier relationships.</p>
                    <button class="btn btn-primary" onclick="showAddSupplierModal()">
                        <i class="fas fa-plus"></i> Add First Supplier
                    </button>
                </div>
                
                <div class="table-responsive" id="suppliers-table-container" style="display: none;">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Supplier</th>
                                <th>Contact Person</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Products</th>
                                <th>Status</th>
                                <th>Rating</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="suppliers-table">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Analytics Section -->
        <div id="analytics-section" style="display: none;">
            <div class="section-header">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="mb-0">Business Analytics</h2>
                        <p class="text-muted mb-0">Detailed insights and performance metrics</p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary" onclick="exportAnalytics()">
                            <i class="fas fa-download"></i> Export Report
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="row mb-4">
                <div class="col-lg-8">
                    <div class="chart-container">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0">Revenue Analytics</h5>
                            <select class="form-select w-auto" id="periodSelect" onchange="updateAnalytics()">
                                <option value="7">Last 7 Days</option>
                                <option value="30" selected>Last 30 Days</option>
                                <option value="90">Last 90 Days</option>
                                <option value="365">Last Year</option>
                            </select>
                        </div>
                        <div id="analyticsChartPlaceholder" class="empty-state">
                            <i class="fas fa-chart-bar"></i>
                            <h5>No Analytics Data</h5>
                            <p>Add transactions and customer data to generate analytics</p>
                        </div>
                        <canvas id="analyticsChart" style="display: none;"></canvas>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="dashboard-card h-100">
                        <h5 class="mb-3">Top Products by Revenue</h5>
                        <div id="top-products-placeholder" class="empty-state" style="padding: 20px 0;">
                            <i class="fas fa-box"></i>
                            <p>Add products and sales to see top performers</p>
                        </div>
                        <div id="top-products" style="display: none;">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h5 class="mb-3">Customer Distribution</h5>
                        <div id="customerChartPlaceholder" class="empty-state">
                            <i class="fas fa-user-chart"></i>
                            <h5>No Customer Data</h5>
                            <p>Add customers to see distribution charts</p>
                        </div>
                        <canvas id="customerChart" style="display: none;"></canvas>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="dashboard-card h-100">
                        <h5 class="mb-3">Key Performance Indicators</h5>
                        <div id="performance-metrics-placeholder" class="empty-state" style="padding: 20px 0;">
                            <i class="fas fa-chart-line"></i>
                            <p>Add business data to see performance metrics</p>
                        </div>
                        <div id="performance-metrics" style="display: none;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Reports Section -->
        <div id="reports-section" style="display: none;">
            <div class="section-header">
                <h2 class="mb-0">Business Reports</h2>
                <p class="text-muted mb-0">Generate and view business reports</p>
            </div>
            
            <div class="row">
                <div class="col-md-4">
                    <div class="dashboard-card text-center">
                        <i class="fas fa-chart-line fa-3x mb-3 text-primary"></i>
                        <h5>Sales Report</h5>
                        <p class="text-muted">Detailed sales analysis</p>
                        <button class="btn btn-primary w-100" onclick="generateSalesReport()">Generate</button>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="dashboard-card text-center">
                        <i class="fas fa-box fa-3x mb-3 text-success"></i>
                        <h5>Inventory Report</h5>
                        <p class="text-muted">Stock levels and valuation</p>
                        <button class="btn btn-success w-100" onclick="generateInventoryReport()">Generate</button>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="dashboard-card text-center">
                        <i class="fas fa-truck fa-3x mb-3 text-warning"></i>
                        <h5>Supplier Report</h5>
                        <p class="text-muted">Supplier performance analysis</p>
                        <button class="btn btn-warning w-100" onclick="generateSupplierReport()">Generate</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Notes Section -->
        <div id="notes-section" style="display: none;">
            <div class="section-header">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="mb-0">Notes & Documentation</h2>
                        <p class="text-muted mb-0">Keep track of important information</p>
                    </div>
                    <button class="btn btn-primary" onclick="showAddNoteModal()">
                        <i class="fas fa-plus"></i> Add Note
                    </button>
                </div>
            </div>
            
            <div id="notes-empty-state" class="empty-state">
                <i class="fas fa-sticky-note"></i>
                <h5>No Notes Yet</h5>
                <p>Add notes to keep track of meetings, tasks, ideas, and important business information.</p>
                <button class="btn btn-primary" onclick="showAddNoteModal()">
                    <i class="fas fa-plus"></i> Add First Note
                </button>
            </div>
            
            <div class="row" id="notes-container" style="display: none;">
            </div>
        </div>
        
        <!-- Settings Section -->
        <div id="settings-section" style="display: none;">
            <div class="section-header">
                <h2 class="mb-0">System Settings</h2>
                <p class="text-muted mb-0">Configure your business management system</p>
            </div>
            
            <div class="row mb-4">
                <div class="col-lg-6">
                    <div class="dashboard-card">
                        <h5 class="mb-3">Data Management</h5>
                        <div class="d-grid gap-3">
                            <button class="btn btn-success" onclick="exportProducts()">
                                <i class="fas fa-file-csv"></i> Export Products to CSV
                            </button>
                            <button class="btn btn-primary" onclick="exportCustomers()">
                                <i class="fas fa-file-csv"></i> Export Customers to CSV
                            </button>
                            <button class="btn btn-warning" onclick="exportSuppliers()">
                                <i class="fas fa-file-csv"></i> Export Suppliers to CSV
                            </button>
                            <button class="btn btn-info" onclick="backupData()">
                                <i class="fas fa-save"></i> Backup All Data
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6">
                    <div class="dashboard-card">
                        <h5 class="mb-3">Data Restore</h5>
                        <div class="mb-3">
                            <label class="form-label">Select Backup File</label>
                            <input type="file" class="form-control" id="restoreFile" accept=".json,.csv">
                        </div>
                        <button class="btn btn-danger w-100 mb-3" onclick="restoreData()">
                            <i class="fas fa-upload"></i> Restore from Backup
                        </button>
                        <small class="text-muted">Warning: Restoring will replace all current data with backup data.</small>
                    </div>
                </div>
            </div>
            
            <!-- Quick Start Section -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="dashboard-card warning-zone">
                        <h5 class="mb-3"><i class="fas fa-rocket text-warning me-2"></i> Quick Start</h5>
                        <p class="text-muted mb-3">Get started quickly by loading sample data or resetting your system.</p>
                        <div class="d-grid gap-2 d-md-flex">
                            <button class="btn btn-warning me-2" onclick="loadSampleData()">
                                <i class="fas fa-vial"></i> Load Sample Data
                            </button>
                            <button class="btn btn-outline-secondary" onclick="showQuickStartGuide()">
                                <i class="fas fa-question-circle"></i> Show Quick Start Guide
                            </button>
                        </div>
                        <small class="text-muted mt-2 d-block">Sample data includes example products, customers, suppliers, and transactions for testing purposes.</small>
                    </div>
                </div>
            </div>
            
            <!-- Danger Zone -->
            <div class="row">
                <div class="col-12">
                    <div class="dashboard-card danger-zone">
                        <h5 class="mb-3"><i class="fas fa-exclamation-triangle text-danger me-2"></i> Danger Zone</h5>
                        <p class="text-muted mb-3">These actions are irreversible. Make sure you have a backup before proceeding.</p>
                        <div class="d-grid gap-3">
                            <button class="btn btn-danger" onclick="resetAllData()">
                                <i class="fas fa-trash-alt"></i> Reset All Data
                            </button>
                            <button class="btn btn-outline-danger" onclick="clearSpecificData()">
                                <i class="fas fa-broom"></i> Clear Specific Data
                            </button>
                        </div>
                        <small class="text-danger mt-2 d-block"><i class="fas fa-exclamation-circle"></i> Warning: These actions cannot be undone. All data will be permanently deleted.</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <!-- Add Product Modal -->
    <div class="modal fade" id="addProductModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="productForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Product Name *</label>
                                <input type="text" class="form-control" id="productName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">SKU Code</label>
                                <input type="text" class="form-control" id="productSKU">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Category *</label>
                                <select class="form-select" id="productCategory" required>
                                    <option value="">Select Category</option>
                                    <option value="Electronics">Electronics</option>
                                    <option value="Clothing">Clothing</option>
                                    <option value="Groceries">Groceries</option>
                                    <option value="Furniture">Furniture</option>
                                    <option value="Books">Books</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Supplier</label>
                                <select class="form-select" id="productSupplier">
                                    <option value="">Select Supplier</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Selling Price (KES) *</label>
                                <input type="number" class="form-control" id="productPrice" required step="0.01">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Cost Price (KES) *</label>
                                <input type="number" class="form-control" id="productCost" required step="0.01">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Current Stock *</label>
                                <input type="number" class="form-control" id="productStock" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Minimum Stock Level</label>
                                <input type="number" class="form-control" id="productMinStock" value="5">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Maximum Stock Level</label>
                                <input type="number" class="form-control" id="productMaxStock" value="100">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="productDescription" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveProduct()">Save Product</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Customer Modal -->
    <div class="modal fade" id="addCustomerModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="customerForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Full Name *</label>
                                <input type="text" class="form-control" id="customerName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email Address *</label>
                                <input type="email" class="form-control" id="customerEmail" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Phone Number *</label>
                                <input type="tel" class="form-control" id="customerPhone" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Customer Type</label>
                                <select class="form-select" id="customerType">
                                    <option value="Regular">Regular</option>
                                    <option value="VIP">VIP</option>
                                    <option value="Wholesale">Wholesale</option>
                                    <option value="Corporate">Corporate</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Address</label>
                            <textarea class="form-control" id="customerAddress" rows="3"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">City</label>
                                <input type="text" class="form-control" id="customerCity">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Country</label>
                                <input type="text" class="form-control" id="customerCountry" value="Kenya">
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="customerActive" checked>
                                <label class="form-check-label" for="customerActive">
                                    Active Customer
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveCustomer()">Save Customer</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Transaction Modal -->
    <div class="modal fade" id="addTransactionModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">New Transaction</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="transactionForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Transaction Type *</label>
                                <select class="form-select" id="transactionType" required onchange="toggleTransactionFields()">
                                    <option value="">Select Type</option>
                                    <option value="sale">Sale</option>
                                    <option value="purchase">Purchase</option>
                                    <option value="refund">Refund</option>
                                    <option value="expense">Expense</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Date *</label>
                                <input type="datetime-local" class="form-control" id="transactionDate" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label id="customerLabel" class="form-label">Customer *</label>
                                <select class="form-select" id="transactionCustomer">
                                    <option value="">Select Customer</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Amount (KES) *</label>
                                <input type="number" class="form-control" id="transactionAmount" required step="0.01">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="transactionDescription" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Payment Method</label>
                            <select class="form-select" id="transactionPaymentMethod">
                                <option value="Cash">Cash</option>
                                <option value="M-Pesa">M-Pesa</option>
                                <option value="Credit Card">Credit Card</option>
                                <option value="Bank Transfer">Bank Transfer</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveTransaction()">Save Transaction</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Supplier Modal -->
    <div class="modal fade" id="addSupplierModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="supplierModalTitle">Add New Supplier</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="supplierForm">
                        <input type="hidden" id="supplierId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Company Name *</label>
                                <input type="text" class="form-control" id="supplierName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Contact Person *</label>
                                <input type="text" class="form-control" id="supplierContact" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email Address *</label>
                                <input type="email" class="form-control" id="supplierEmail" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Phone Number *</label>
                                <input type="tel" class="form-control" id="supplierPhone" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Website</label>
                                <input type="url" class="form-control" id="supplierWebsite" placeholder="https://example.com">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Supplier Type</label>
                                <select class="form-select" id="supplierType">
                                    <option value="Manufacturer">Manufacturer</option>
                                    <option value="Distributor">Distributor</option>
                                    <option value="Wholesaler">Wholesaler</option>
                                    <option value="Retailer">Retailer</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Products Supplied</label>
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" id="newProductInput" placeholder="Add a product (e.g., Laptops)">
                                <button class="btn btn-outline-secondary" type="button" onclick="addProductTag()">
                                    <i class="fas fa-plus"></i> Add
                                </button>
                            </div>
                            <div id="productTagsContainer" class="d-flex flex-wrap gap-2 mt-2">
                            </div>
                            <input type="hidden" id="supplierProducts">
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Address</label>
                                <textarea class="form-control" id="supplierAddress" rows="2"></textarea>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">City</label>
                                <input type="text" class="form-control" id="supplierCity">
                                <label class="form-label mt-2">Country</label>
                                <input type="text" class="form-control" id="supplierCountry" value="Kenya">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Payment Terms (days)</label>
                                <input type="number" class="form-control" id="supplierPaymentTerms" value="30">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Rating (1-5)</label>
                                <select class="form-select" id="supplierRating">
                                    <option value="5">5 - Excellent</option>
                                    <option value="4">4 - Very Good</option>
                                    <option value="3" selected>3 - Good</option>
                                    <option value="2">2 - Fair</option>
                                    <option value="1">1 - Poor</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="supplierStatus">
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                    <option value="preferred">Preferred</option>
                                    <option value="pending">Pending</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" id="supplierNotes" rows="3" placeholder="Any additional notes about this supplier"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveSupplier()">Save Supplier</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Note Modal -->
    <div class="modal fade" id="addNoteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Note</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="noteForm">
                        <div class="mb-3">
                            <label class="form-label">Title *</label>
                            <input type="text" class="form-control" id="noteTitle" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Content *</label>
                            <textarea class="form-control" id="noteContent" rows="5" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Category</label>
                            <select class="form-select" id="noteCategory">
                                <option value="General">General</option>
                                <option value="Meeting">Meeting</option>
                                <option value="Task">Task</option>
                                <option value="Idea">Idea</option>
                                <option value="Reminder">Reminder</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveNote()">Save Note</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Clear Data Modal -->
    <div class="modal fade" id="clearDataModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Clear Specific Data</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-3">Select which data you want to clear:</p>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="clearProducts">
                        <label class="form-check-label" for="clearProducts">
                            <strong>Products</strong> - All product inventory data
                        </label>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="clearCustomers">
                        <label class="form-check-label" for="clearCustomers">
                            <strong>Customers</strong> - All customer records
                        </label>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="clearTransactions">
                        <label class="form-check-label" for="clearTransactions">
                            <strong>Transactions</strong> - All sales and purchase records
                        </label>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="clearSuppliers">
                        <label class="form-check-label" for="clearSuppliers">
                            <strong>Suppliers</strong> - All supplier information
                        </label>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="clearNotes">
                        <label class="form-check-label" for="clearNotes">
                            <strong>Notes</strong> - All notes and documentation
                        </label>
                    </div>
                    <div class="alert alert-warning mt-3">
                        <i class="fas fa-exclamation-triangle"></i> This action cannot be undone. Make sure you have a backup.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="executeClearData()">Clear Selected Data</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Main Application JavaScript -->
    <script>
        // Global variables - ALL START EMPTY
        let currentSection = 'dashboard';
        let products = [];
        let customers = [];
        let transactions = [];
        let suppliers = [];
        let notes = [];
        let salesChart = null;
        let analyticsChart = null;
        let customerChart = null;
        let currentSupplierId = null;
        let supplierProductTags = [];
        
        // Sample data for optional loading - NOT loaded by default
        const sampleData = {
            products: [
                { id: 1, name: "Laptop Pro X1", sku: "LP-001", category: "Electronics", price: 125000, cost: 100000, stock: 15, minStock: 5, maxStock: 50, supplier: "Tech Suppliers Ltd", status: "active", description: "High-performance business laptop" },
                { id: 2, name: "Wireless Mouse", sku: "WM-002", category: "Electronics", price: 2500, cost: 1800, stock: 45, minStock: 10, maxStock: 100, supplier: "Tech Suppliers Ltd", status: "active", description: "Ergonomic wireless mouse" },
                { id: 3, name: "Office Chair", sku: "OC-003", category: "Furniture", price: 8500, cost: 6000, stock: 8, minStock: 5, maxStock: 20, supplier: "Furniture World", status: "active", description: "Ergonomic office chair" },
                { id: 4, name: "Coffee Maker", sku: "CM-004", category: "Appliances", price: 15000, cost: 12000, stock: 3, minStock: 5, maxStock: 15, supplier: "Home Appliances Inc", status: "low", description: "Automatic coffee machine" },
                { id: 5, name: "Desk Lamp", sku: "DL-005", category: "Furniture", price: 3500, cost: 2500, stock: 0, minStock: 5, maxStock: 30, supplier: "Furniture World", status: "out", description: "LED desk lamp" }
            ],
            customers: [
                { id: 1, name: "John Smith", email: "john@example.com", phone: "+254712345678", type: "VIP", address: "123 Main St", city: "Nairobi", country: "Kenya", totalOrders: 12, totalSpent: 450000, lastOrder: new Date().toISOString().split('T')[0], status: "active", joinDate: "2023-05-10" },
                { id: 2, name: "Sarah Johnson", email: "sarah@example.com", phone: "+254723456789", type: "Regular", address: "456 Park Ave", city: "Mombasa", country: "Kenya", totalOrders: 5, totalSpent: 125000, lastOrder: new Date().toISOString().split('T')[0], status: "active", joinDate: "2023-08-22" },
                { id: 3, name: "Tech Solutions Ltd", email: "info@techsolutions.co.ke", phone: "+254734567890", type: "Corporate", address: "789 Business Park", city: "Nairobi", country: "Kenya", totalOrders: 8, totalSpent: 320000, lastOrder: new Date().toISOString().split('T')[0], status: "active", joinDate: "2023-03-15" }
            ],
            transactions: [
                { id: 1, date: new Date().toISOString().slice(0, 16), type: "sale", amount: 125000, customer: "John Smith", description: "Laptop Pro X1", paymentMethod: "M-Pesa", status: "completed", items: 1 },
                { id: 2, date: new Date().toISOString().slice(0, 16), type: "sale", amount: 8500, customer: "Sarah Johnson", description: "Office Chair", paymentMethod: "Cash", status: "completed", items: 1 },
                { id: 3, date: new Date().toISOString().slice(0, 16), type: "purchase", amount: 24000, supplier: "Tech Suppliers Ltd", description: "Mouse restock", paymentMethod: "Bank Transfer", status: "completed", items: 10 }
            ],
            suppliers: [
                { id: 1, name: "Tech Suppliers Ltd", contact: "David Wangari", email: "david@techsuppliers.co.ke", phone: "+254711223344", website: "https://techsuppliers.co.ke", products: ["Laptops", "Accessories", "Monitors", "Printers"], address: "123 Tech Street", city: "Nairobi", country: "Kenya", type: "Distributor", paymentTerms: 30, rating: 4, status: "active", notes: "Reliable supplier with good quality products", totalPurchases: 450000, totalOrders: 12, avgDeliveryTime: 3, joinDate: "2023-03-15" },
                { id: 2, name: "Furniture World", contact: "Susan Atieno", email: "susan@furnitureworld.co.ke", phone: "+254722334455", website: "https://furnitureworld.co.ke", products: ["Chairs", "Desks", "Lamps", "Tables"], address: "456 Furniture Ave", city: "Mombasa", country: "Kenya", type: "Manufacturer", paymentTerms: 45, rating: 5, status: "preferred", notes: "Excellent quality furniture, slightly higher prices", totalPurchases: 280000, totalOrders: 8, avgDeliveryTime: 7, joinDate: "2023-05-20" }
            ],
            notes: [
                { id: 1, title: "Meeting with Tech Suppliers", content: "Discuss new product line and pricing for Q2 2024", category: "Meeting", date: new Date().toISOString().split('T')[0], priority: "high" },
                { id: 2, title: "Inventory Audit", content: "Need to conduct physical inventory count by end of month", category: "Task", date: new Date().toISOString().split('T')[0], priority: "medium" }
            ]
        };
        
        // Initialize application - ALL DATA STARTS EMPTY
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize with EMPTY arrays - NO sample data
            products = [];
            customers = [];
            transactions = [];
            suppliers = [];
            notes = [];
            
            // Check if there's saved data in localStorage
            const savedData = localStorage.getItem('businessSuiteData');
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    if (parsedData.products) products = parsedData.products;
                    if (parsedData.customers) customers = parsedData.customers;
                    if (parsedData.transactions) transactions = parsedData.transactions;
                    if (parsedData.suppliers) suppliers = parsedData.suppliers;
                    if (parsedData.notes) notes = parsedData.notes;
                    
                    showAlert('Previous session data loaded from browser storage', 'info');
                } catch (e) {
                    console.error('Error loading saved data:', e);
                }
            }
            
            // Load initial data
            loadDashboard();
            loadProducts();
            loadCustomers();
            loadTransactions();
            loadSuppliers();
            loadNotes();
            
            // Set current date for transaction form
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('transactionDate').value = now.toISOString().slice(0, 16);
            
            // Auto-save data periodically
            setInterval(saveToLocalStorage, 30000); // Save every 30 seconds
            
            // Initialize tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
            
            // Show welcome message for first-time users
            if (!localStorage.getItem('businessSuiteFirstRun')) {
                setTimeout(() => {
                    showAlert('Welcome to Business Suite Pro! Start by adding your products, customers, and suppliers.', 'info');
                    localStorage.setItem('businessSuiteFirstRun', 'true');
                }, 1000);
            }
        });
        
        // Save data to localStorage
        function saveToLocalStorage() {
            const dataToSave = {
                products: products,
                customers: customers,
                transactions: transactions,
                suppliers: suppliers,
                notes: notes,
                lastSave: new Date().toISOString()
            };
            
            try {
                localStorage.setItem('businessSuiteData', JSON.stringify(dataToSave));
            } catch (e) {
                console.error('Error saving data:', e);
            }
        }
        
        // Navigation
        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.main-content > div').forEach(div => {
                div.style.display = 'none';
            });
            
            // Update nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Show selected section
            document.getElementById(`${section}-section`).style.display = 'block';
            currentSection = section;
            
            // Load section data if needed
            if (section === 'dashboard') {
                loadDashboard();
            } else if (section === 'suppliers') {
                loadSuppliers();
            }
        }
        
        // Dashboard Functions
        function loadDashboard() {
            // Calculate dashboard stats
            const totalSales = transactions
                .filter(t => t.type === 'sale')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const activeSuppliers = suppliers.filter(s => s.status === 'active' || s.status === 'preferred').length;
            const stockValue = products.reduce((sum, p) => sum + (p.price * p.stock), 0);
            const activeCustomers = customers.filter(c => c.status === 'active').length;
            
            // Update dashboard stats
            document.getElementById('total-sales').textContent = `KES ${totalSales.toLocaleString()}`;
            document.getElementById('total-products').textContent = products.length;
            document.getElementById('total-customers').textContent = activeCustomers;
            document.getElementById('total-suppliers').textContent = activeSuppliers;
            
            // Update counts in sidebar
            document.getElementById('customer-count').textContent = activeCustomers;
            document.getElementById('supplier-count').textContent = activeSuppliers;
            
            // Show/hide sales chart based on data
            if (transactions.filter(t => t.type === 'sale').length > 0) {
                document.getElementById('salesChartPlaceholder').style.display = 'none';
                document.getElementById('salesChart').style.display = 'block';
                createSalesChart();
            } else {
                document.getElementById('salesChartPlaceholder').style.display = 'block';
                document.getElementById('salesChart').style.display = 'none';
            }
            
            // Load recent transactions
            loadRecentTransactions();
            
            // Load quick stats
            loadQuickStats();
            
            // Load top customers
            loadTopCustomers();
        }
        
        function createSalesChart() {
            const ctx = document.getElementById('salesChart').getContext('2d');
            if (salesChart) salesChart.destroy();
            
            // Get sales data from transactions
            const salesTransactions = transactions.filter(t => t.type === 'sale');
            
            if (salesTransactions.length === 0) {
                return;
            }
            
            // Group by date (simplified - in real app would group by day/week/month)
            const labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
            const salesData = [0, 0, 0, 0];
            
            // Distribute sales across weeks for demo
            salesTransactions.forEach(transaction => {
                const weekIndex = Math.min(Math.floor(Math.random() * 4), 3);
                salesData[weekIndex] += transaction.amount / 1000; // Scale down for chart
            });
            
            salesChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Weekly Sales (KES)',
                        data: salesData,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#3498db',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: true,
                            position: 'top',
                            labels: {
                                font: { size: 12 },
                                padding: 20
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'KES ' + (value * 1000).toLocaleString();
                                },
                                font: { size: 11 }
                            },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        x: {
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        }
                    }
                }
            });
        }
        
        function loadRecentTransactions() {
            const container = document.getElementById('recent-transactions-container');
            const placeholder = document.getElementById('recent-transactions-placeholder');
            const table = document.getElementById('recent-transactions');
            
            if (transactions.length === 0) {
                container.style.display = 'none';
                placeholder.style.display = 'block';
                return;
            }
            
            container.style.display = 'block';
            placeholder.style.display = 'none';
            
            const recent = transactions.slice(-5).reverse();
            
            table.innerHTML = '';
            recent.forEach(transaction => {
                const typeBadge = transaction.type === 'sale' ? 
                    '<span class="badge bg-success">Sale</span>' : 
                    transaction.type === 'purchase' ? 
                    '<span class="badge bg-warning">Purchase</span>' : 
                    '<span class="badge bg-danger">Refund</span>';
                
                const row = `
                    <tr>
                        <td>${new Date(transaction.date).toLocaleDateString()}</td>
                        <td>${transaction.customer || transaction.supplier || '-'}</td>
                        <td class="fw-bold">KES ${transaction.amount.toLocaleString()}</td>
                        <td>${typeBadge}</td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }
        
        function loadQuickStats() {
            const container = document.getElementById('quick-stats');
            
            if (products.length === 0 && customers.length === 0 && suppliers.length === 0) {
                return;
            }
            
            const stats = [
                { label: 'Active Products', value: products.filter(p => p.status === 'active').length, icon: 'fa-box' },
                { label: 'Low Stock Items', value: products.filter(p => p.status === 'low').length, icon: 'fa-exclamation-triangle', color: 'text-warning' },
                { label: 'Out of Stock', value: products.filter(p => p.status === 'out').length, icon: 'fa-times-circle', color: 'text-danger' },
                { label: 'Active Suppliers', value: suppliers.filter(s => s.status === 'active' || s.status === 'preferred').length, icon: 'fa-truck', color: 'text-info' }
            ];
            
            let html = '';
            stats.forEach(stat => {
                html += `
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="d-flex align-items-center">
                            <i class="fas ${stat.icon} ${stat.color || 'text-primary'} me-3"></i>
                            <span>${stat.label}</span>
                        </div>
                        <span class="fw-bold fs-5">${stat.value}</span>
                    </div>
                `;
            });
            container.innerHTML = html;
        }
        
        function loadTopCustomers() {
            const container = document.getElementById('top-customers');
            const placeholder = document.getElementById('top-customers-placeholder');
            
            if (customers.length === 0) {
                container.style.display = 'none';
                placeholder.style.display = 'block';
                return;
            }
            
            container.style.display = 'block';
            placeholder.style.display = 'none';
            
            const topCustomers = customers
                .filter(c => c.status === 'active')
                .sort((a, b) => (b.totalSpent || 0) - (a.totalSpent || 0))
                .slice(0, 5);
            
            let html = '';
            topCustomers.forEach(customer => {
                const initials = customer.name.split(' ').map(n => n[0]).join('').toUpperCase();
                html += `
                    <div class="d-flex align-items-center mb-3">
                        <div class="avatar me-3" style="width: 45px; height: 45px; background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
                            ${initials.substring(0, 2)}
                        </div>
                        <div class="flex-grow-1">
                            <div class="fw-bold">${customer.name}</div>
                            <small class="text-muted">KES ${(customer.totalSpent || 0).toLocaleString()} spent</small>
                        </div>
                        <div class="badge bg-success">${customer.type}</div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }
        
        // Products Functions
        function loadProducts() {
            const table = document.getElementById('products-table');
            const container = document.getElementById('products-table-container');
            const emptyState = document.getElementById('products-empty-state');
            
            if (products.length === 0) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }
            
            container.style.display = 'block';
            emptyState.style.display = 'none';
            table.innerHTML = '';
            
            products.forEach(product => {
                const stockStatus = product.stock <= 0 ? 'badge-low' : product.stock <= (product.minStock || 5) ? 'badge-warning' : 'badge-ok';
                const statusText = product.stock <= 0 ? 'Out of Stock' : product.stock <= (product.minStock || 5) ? 'Low Stock' : 'In Stock';
                
                const row = `
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="avatar me-3" style="width: 40px; height: 40px; background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);">
                                    <i class="fas fa-box"></i>
                                </div>
                                <div>
                                    <div class="fw-bold">${product.name}</div>
                                    <small class="text-muted">${product.description || 'No description'}</small>
                                </div>
                            </div>
                        </td>
                        <td><code>${product.sku || 'N/A'}</code></td>
                        <td><span class="badge bg-secondary">${product.category}</span></td>
                        <td class="fw-bold">KES ${product.price.toLocaleString()}</td>
                        <td>KES ${product.cost.toLocaleString()}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                <span class="me-2">${product.stock}</span>
                                <span class="badge ${stockStatus}">${statusText}</span>
                            </div>
                        </td>
                        <td>
                            <span class="badge bg-success">Active</span>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="editProduct(${product.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteProduct(${product.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }
        
        function searchProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const filtered = products.filter(product => 
                product.name.toLowerCase().includes(searchTerm) ||
                (product.sku && product.sku.toLowerCase().includes(searchTerm)) ||
                (product.category && product.category.toLowerCase().includes(searchTerm)) ||
                (product.description && product.description.toLowerCase().includes(searchTerm))
            );
            
            const table = document.getElementById('products-table');
            
            if (filtered.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-5">
                            <i class="fas fa-search fa-2x text-muted mb-3"></i>
                            <p class="text-muted">No products found matching your search</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            table.innerHTML = '';
            
            filtered.forEach(product => {
                const stockStatus = product.stock <= 0 ? 'badge-low' : product.stock <= product.minStock ? 'badge-warning' : 'badge-ok';
                const statusText = product.stock <= 0 ? 'Out of Stock' : product.stock <= product.minStock ? 'Low Stock' : 'In Stock';
                
                const row = `
                    <tr>
                        <td>${product.name}</td>
                        <td><code>${product.sku || 'N/A'}</code></td>
                        <td><span class="badge bg-secondary">${product.category}</span></td>
                        <td class="fw-bold">KES ${product.price.toLocaleString()}</td>
                        <td>KES ${product.cost.toLocaleString()}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                <span class="me-2">${product.stock}</span>
                                <span class="badge ${stockStatus}">${statusText}</span>
                            </div>
                        </td>
                        <td>
                            <span class="badge bg-success">Active</span>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="editProduct(${product.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteProduct(${product.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }
        
        function filterProducts(type) {
            let filtered = products;
            if (type === 'low') {
                filtered = products.filter(p => p.stock <= (p.minStock || 5) && p.stock > 0);
            } else if (type === 'out') {
                filtered = products.filter(p => p.stock <= 0);
            } else if (type === 'active') {
                filtered = products.filter(p => p.status === 'active');
            }
            
            const table = document.getElementById('products-table');
            
            if (filtered.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-5">
                            <i class="fas fa-filter fa-2x text-muted mb-3"></i>
                            <p class="text-muted">No ${type === 'low' ? 'low stock' : type === 'out' ? 'out of stock' : 'active'} products found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            table.innerHTML = '';
            
            filtered.forEach(product => {
                const stockStatus = product.stock <= 0 ? 'badge-low' : product.stock <= product.minStock ? 'badge-warning' : 'badge-ok';
                const statusText = product.stock <= 0 ? 'Out of Stock' : product.stock <= product.minStock ? 'Low Stock' : 'In Stock';
                
                const row = `
                    <tr>
                        <td>${product.name}</td>
                        <td><code>${product.sku || 'N/A'}</code></td>
                        <td><span class="badge bg-secondary">${product.category}</span></td>
                        <td class="fw-bold">KES ${product.price.toLocaleString()}</td>
                        <td>KES ${product.cost.toLocaleString()}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                <span class="me-2">${product.stock}</span>
                                <span class="badge ${stockStatus}">${statusText}</span>
                            </div>
                        </td>
                        <td>
                            <span class="badge bg-success">Active</span>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="editProduct(${product.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteProduct(${product.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }
        
        function showAddProductModal() {
            // Populate supplier dropdown
            const supplierSelect = document.getElementById('productSupplier');
            supplierSelect.innerHTML = '<option value="">Select Supplier</option>';
            suppliers.forEach(supplier => {
                supplierSelect.innerHTML += `<option value="${supplier.name}">${supplier.name}</option>`;
            });
            
            document.getElementById('productForm').reset();
            new bootstrap.Modal(document.getElementById('addProductModal')).show();
        }
        
        function saveProduct() {
            const product = {
                id: products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1,
                name: document.getElementById('productName').value,
                sku: document.getElementById('productSKU').value || `PROD-${Date.now().toString().slice(-6)}`,
                category: document.getElementById('productCategory').value,
                price: parseFloat(document.getElementById('productPrice').value),
                cost: parseFloat(document.getElementById('productCost').value),
                stock: parseInt(document.getElementById('productStock').value),
                minStock: parseInt(document.getElementById('productMinStock').value) || 5,
                maxStock: parseInt(document.getElementById('productMaxStock').value) || 100,
                supplier: document.getElementById('productSupplier').value || '',
                description: document.getElementById('productDescription').value,
                status: 'active'
            };
            
            // Determine stock status
            if (product.stock <= 0) {
                product.status = 'out';
            } else if (product.stock <= product.minStock) {
                product.status = 'low';
            }
            
            products.push(product);
            bootstrap.Modal.getInstance(document.getElementById('addProductModal')).hide();
            loadProducts();
            loadDashboard();
            saveToLocalStorage();
            showAlert('Product added successfully!', 'success');
        }
        
        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                document.getElementById('productName').value = product.name;
                document.getElementById('productSKU').value = product.sku || '';
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productCost').value = product.cost;
                document.getElementById('productStock').value = product.stock;
                document.getElementById('productMinStock').value = product.minStock || 5;
                document.getElementById('productMaxStock').value = product.maxStock || 100;
                document.getElementById('productSupplier').value = product.supplier || '';
                document.getElementById('productDescription').value = product.description || '';
                
                new bootstrap.Modal(document.getElementById('addProductModal')).show();
                showAlert('Edit mode activated. Update the product details.', 'info');
            }
        }
        
        function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product? This action cannot be undone.')) {
                const index = products.findIndex(p => p.id === productId);
                if (index > -1) {
                    products.splice(index, 1);
                    loadProducts();
                    loadDashboard();
                    saveToLocalStorage();
                    showAlert('Product deleted successfully!', 'success');
                }
            }
        }
        
        // Customers Functions
        function loadCustomers() {
            const table = document.getElementById('customers-table');
            const container = document.getElementById('customers-table-container');
            const emptyState = document.getElementById('customers-empty-state');
            
            if (customers.length === 0) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }
            
            container.style.display = 'block';
            emptyState.style.display = 'none';
            table.innerHTML = '';
            
            // Update customer stats
            const activeCustomers = customers.filter(c => c.status === 'active').length;
            const totalSpent = customers.reduce((sum, c) => sum + (c.totalSpent || 0), 0);
            const totalOrders = customers.reduce((sum, c) => sum + (c.totalOrders || 0), 0);
            const avgOrderValue = totalOrders > 0 ? totalSpent / totalOrders : 0;
            const repeatRate = customers.length > 0 ? 
                (customers.filter(c => (c.totalOrders || 0) > 1).length / customers.length * 100).toFixed(1) : 0;
            
            document.getElementById('total-active-customers').textContent = activeCustomers;
            document.getElementById('customer-growth').textContent = '+0%';
            document.getElementById('avg-order-value').textContent = `KES ${avgOrderValue.toFixed(0).toLocaleString()}`;
            document.getElementById('repeat-rate').textContent = `${repeatRate}%`;
            
            customers.forEach(customer => {
                const statusClass = customer.status === 'active' ? 'status-active' : 'status-inactive';
                const statusText = customer.status === 'active' ? 'Active' : 'Inactive';
                const typeClass = customer.type === 'VIP' ? 'badge bg-warning' : 
                                 customer.type === 'Corporate' ? 'badge bg-info' : 
                                 customer.type === 'Wholesale' ? 'badge bg-secondary' : 'badge bg-primary';
                const initials = customer.name.split(' ').map(n => n[0]).join('').toUpperCase();
                
                const row = `
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="avatar me-3" style="width: 45px; height: 45px; background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
                                    ${initials.substring(0, 2)}
                                </div>
                                <div>
                                    <div class="fw-bold">${customer.name}</div>
                                    <small class="text-muted">${customer.type} Customer</small>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div>${customer.email}</div>
                            <small class="text-muted">${customer.phone}</small>
                        </td>
                        <td>
                            <div class="text-center">
                                <div class="fw-bold fs-5">${customer.totalOrders || 0}</div>
                                <small class="text-muted">orders</small>
                            </div>
                        </td>
                        <td class="fw-bold">KES ${(customer.totalSpent || 0).toLocaleString()}</td>
                        <td>${customer.lastOrder ? new Date(customer.lastOrder).toLocaleDateString() : 'Never'}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                <span class="status-indicator ${statusClass}"></span>
                                <span>${statusText}</span>
                            </div>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="editCustomer(${customer.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteCustomer(${customer.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }
        
        function searchCustomers() {
            const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
            const filtered = customers.filter(customer => 
                customer.name.toLowerCase().includes(searchTerm) ||
                customer.email.toLowerCase().includes(searchTerm) ||
                customer.phone.includes(searchTerm) ||
                customer.type.toLowerCase().includes(searchTerm) ||
                (customer.city && customer.city.toLowerCase().includes(searchTerm))
            );
            
            const table = document.getElementById('customers-table');
            
            if (filtered.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-5">
                            <i class="fas fa-search fa-2x text-muted mb-3"></i>
                            <p class="text-muted">No customers found matching your search</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            table.innerHTML = '';
            
            filtered.forEach(customer => {
                const statusClass = customer.status === 'active' ? 'status-active' : 'status-inactive';
                const statusText = customer.status === 'active' ? 'Active' : 'Inactive';
                const initials = customer.name.split(' ').map(n => n[0]).join('').toUpperCase();
                
                const row = `
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="avatar me-3" style="width: 45px; height: 45px; background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
                                    ${initials.substring(0, 2)}
                                </div>
                                <div>
                                    <div class="fw-bold">${customer.name}</div>
                                    <small class="text-muted">${customer.type} Customer</small>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div>${customer.email}</div>
                            <small class="text-muted">${customer.phone}</small>
                        </td>
                        <td>${customer.totalOrders || 0}</td>
                        <td class="fw-bold">KES ${(customer.totalSpent || 0).toLocaleString()}</td>
                        <td>${customer.lastOrder ? new Date(customer.lastOrder).toLocaleDateString() : 'Never'}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                <span class="status-indicator ${statusClass}"></span>
                                <span>${statusText}</span>
                            </div>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="editCustomer(${customer.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteCustomer(${customer.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }
        
        function filterCustomers(type) {
            let filtered = customers;
            if (type === 'active') {
                filtered = customers.filter(c => c.status === 'active');
            } else if (type === 'inactive') {
                filtered = customers.filter(c => c.status === 'inactive');
            } else if (type === 'vip') {
                filtered = customers.filter(c => c.type === 'VIP');
            }
            
            const table = document.getElementById('customers-table');
            
            if (filtered.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-5">
                            <i class="fas fa-filter fa-2x text-muted mb-3"></i>
                            <p class="text-muted">No ${type} customers found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            table.innerHTML = '';
            
            filtered.forEach(customer => {
                const statusClass = customer.status === 'active' ? 'status-active' : 'status-inactive';
                const statusText = customer.status === 'active' ? 'Active' : 'Inactive';
                const initials = customer.name.split(' ').map(n => n[0]).join('').toUpperCase();
                
                const row = `
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="avatar me-3" style="width: 45px; height: 45px; background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
                                    ${initials.substring(0, 2)}
                                </div>
                                <div>
                                    <div class="fw-bold">${customer.name}</div>
                                    <small class="text-muted">${customer.type} Customer</small>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div>${customer.email}</div>
                            <small class="text-muted">${customer.phone}</small>
                        </td>
                        <td>${customer.totalOrders || 0}</td>
                        <td class="fw-bold">KES ${(customer.totalSpent || 0).toLocaleString()}</td>
                        <td>${customer.lastOrder ? new Date(customer.lastOrder).toLocaleDateString() : 'Never'}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                <span class="status-indicator ${statusClass}"></span>
                                <span>${statusText}</span>
                            </div>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="editCustomer(${customer.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteCustomer(${customer.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }
        
        function showAddCustomerModal() {
            document.getElementById('customerForm').reset();
            new bootstrap.Modal(document.getElementById('addCustomerModal')).show();
        }
        
        function saveCustomer() {
            const customer = {
                id: customers.length > 0 ? Math.max(...customers.map(c => c.id)) + 1 : 1,
                name: document.getElementById('customerName').value,
                email: document.getElementById('customerEmail').value,
                phone: document.getElementById('customerPhone').value,
                type: document.getElementById('customerType').value,
                address: document.getElementById('customerAddress').value,
                city: document.getElementById('customerCity').value,
                country: document.getElementById('customerCountry').value,
                totalOrders: 0,
                totalSpent: 0,
                lastOrder: null,
                status: document.getElementById('customerActive').checked ? 'active' : 'inactive',
                joinDate: new Date().toISOString().split('T')[0]
            };
            
            customers.push(customer);
            bootstrap.Modal.getInstance(document.getElementById('addCustomerModal')).hide();
            loadCustomers();
            loadDashboard();
            saveToLocalStorage();
            showAlert('Customer added successfully!', 'success');
        }
        
        function editCustomer(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (customer) {
                document.getElementById('customerName').value = customer.name;
                document.getElementById('customerEmail').value = customer.email;
                document.getElementById('customerPhone').value = customer.phone;
                document.getElementById('customerType').value = customer.type;
                document.getElementById('customerAddress').value = customer.address || '';
                document.getElementById('customerCity').value = customer.city || '';
                document.getElementById('customerCountry').value = customer.country || 'Kenya';
                document.getElementById('customerActive').checked = customer.status === 'active';
                
                new bootstrap.Modal(document.getElementById('addCustomerModal')).show();
                showAlert('Edit mode activated. Update the customer details.', 'info');
            }
        }
        
        function deleteCustomer(customerId) {
            if (confirm('Are you sure you want to delete this customer? This action cannot be undone.')) {
                const index = customers.findIndex(c => c.id === customerId);
                if (index > -1) {
                    customers.splice(index, 1);
                    loadCustomers();
                    loadDashboard();
                    saveToLocalStorage();
                    showAlert('Customer deleted successfully!', 'success');
                }
            }
        }
        
        // Transactions Functions
        function loadTransactions() {
            const table = document.getElementById('transactions-table');
            const container = document.getElementById('transactions-table-container');
            const emptyState = document.getElementById('transactions-empty-state');
            
            if (transactions.length === 0) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }
            
            container.style.display = 'block';
            emptyState.style.display = 'none';
            table.innerHTML = '';
            
            transactions.forEach(transaction => {
                const typeBadge = transaction.type === 'sale' ? 
                    '<span class="badge bg-success">Sale</span>' : 
                    transaction.type === 'purchase' ? 
                    '<span class="badge bg-warning">Purchase</span>' : 
                    '<span class="badge bg-danger">Refund</span>';
                
                const statusBadge = transaction.status === 'completed' ? 
                    '<span class="badge bg-success">Completed</span>' : 
                    '<span class="badge bg-warning">Pending</span>';
                
                const row = `
                    <tr>
                        <td>${new Date(transaction.date).toLocaleString()}</td>
                        <td>${typeBadge}</td>
                        <td class="fw-bold">KES ${transaction.amount.toLocaleString()}</td>
                        <td>${transaction.customer || transaction.supplier || '-'}</td>
                        <td>${transaction.items || 1} item(s)</td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-info" onclick="viewTransaction(${transaction.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteTransaction(${transaction.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }
        
        function searchTransactions() {
            const searchTerm = document.getElementById('transactionSearch').value.toLowerCase();
            const filtered = transactions.filter(transaction => 
                (transaction.customer && transaction.customer.toLowerCase().includes(searchTerm)) ||
                (transaction.supplier && transaction.supplier.toLowerCase().includes(searchTerm)) ||
                transaction.description.toLowerCase().includes(searchTerm) ||
                transaction.type.toLowerCase().includes(searchTerm) ||
                transaction.amount.toString().includes(searchTerm)
            );
            
            const table = document.getElementById('transactions-table');
            
            if (filtered.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-5">
                            <i class="fas fa-search fa-2x text-muted mb-3"></i>
                            <p class="text-muted">No transactions found matching your search</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            table.innerHTML = '';
            
            filtered.forEach(transaction => {
                const typeBadge = transaction.type === 'sale' ? 
                    '<span class="badge bg-success">Sale</span>' : 
                    transaction.type === 'purchase' ? 
                    '<span class="badge bg-warning">Purchase</span>' : 
                    '<span class="badge bg-danger">Refund</span>';
                
                const statusBadge = transaction.status === 'completed' ? 
                    '<span class="badge bg-success">Completed</span>' : 
                    '<span class="badge bg-warning">Pending</span>';
                
                const row = `
                    <tr>
                        <td>${new Date(transaction.date).toLocaleString()}</td>
                        <td>${typeBadge}</td>
                        <td class="fw-bold">KES ${transaction.amount.toLocaleString()}</td>
                        <td>${transaction.customer || transaction.supplier || '-'}</td>
                        <td>${transaction.items || 1} item(s)</td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-info" onclick="viewTransaction(${transaction.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteTransaction(${transaction.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }
        
        function filterTransactions(type) {
            let filtered = transactions;
            if (type !== 'all') {
                filtered = transactions.filter(t => t.type === type);
            }
            
            const table = document.getElementById('transactions-table');
            
            if (filtered.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-5">
                            <i class="fas fa-filter fa-2x text-muted mb-3"></i>
                            <p class="text-muted">No ${type} transactions found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            table.innerHTML = '';
            
            filtered.forEach(transaction => {
                const typeBadge = transaction.type === 'sale' ? 
                    '<span class="badge bg-success">Sale</span>' : 
                    transaction.type === 'purchase' ? 
                    '<span class="badge bg-warning">Purchase</span>' : 
                    '<span class="badge bg-danger">Refund</span>';
                
                const statusBadge = transaction.status === 'completed' ? 
                    '<span class="badge bg-success">Completed</span>' : 
                    '<span class="badge bg-warning">Pending</span>';
                
                const row = `
                    <tr>
                        <td>${new Date(transaction.date).toLocaleString()}</td>
                        <td>${typeBadge}</td>
                        <td class="fw-bold">KES ${transaction.amount.toLocaleString()}</td>
                        <td>${transaction.customer || transaction.supplier || '-'}</td>
                        <td>${transaction.items || 1} item(s)</td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-info" onclick="viewTransaction(${transaction.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteTransaction(${transaction.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }
        
        function showAddTransactionModal() {
            // Populate customer dropdown
            const customerSelect = document.getElementById('transactionCustomer');
            customerSelect.innerHTML = '<option value="">Select Customer</option>';
            customers.forEach(customer => {
                customerSelect.innerHTML += `<option value="${customer.name}">${customer.name}</option>`;
            });
            
            // Set default date to now
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('transactionDate').value = now.toISOString().slice(0, 16);
            
            document.getElementById('transactionForm').reset();
            new bootstrap.Modal(document.getElementById('addTransactionModal')).show();
        }
        
        function toggleTransactionFields() {
            const type = document.getElementById('transactionType').value;
            const label = document.getElementById('customerLabel');
            const select = document.getElementById('transactionCustomer');
            
            if (type === 'purchase' || type === 'expense') {
                label.textContent = 'Supplier *';
                select.innerHTML = '<option value="">Select Supplier</option>';
                suppliers.forEach(supplier => {
                    select.innerHTML += `<option value="${supplier.name}">${supplier.name}</option>`;
                });
            } else {
                label.textContent = 'Customer *';
                select.innerHTML = '<option value="">Select Customer</option>';
                customers.forEach(customer => {
                    select.innerHTML += `<option value="${customer.name}">${customer.name}</option>`;
                });
            }
        }
        
        function saveTransaction() {
            const type = document.getElementById('transactionType').value;
            const transaction = {
                id: transactions.length > 0 ? Math.max(...transactions.map(t => t.id)) + 1 : 1,
                type: type,
                date: document.getElementById('transactionDate').value,
                amount: parseFloat(document.getElementById('transactionAmount').value),
                description: document.getElementById('transactionDescription').value,
                paymentMethod: document.getElementById('transactionPaymentMethod').value,
                status: 'completed'
            };
            
            if (type === 'sale' || type === 'refund') {
                transaction.customer = document.getElementById('transactionCustomer').value;
            } else {
                transaction.supplier = document.getElementById('transactionCustomer').value;
                
                // Update supplier purchase history if it's a purchase
                if (type === 'purchase') {
                    const supplierName = document.getElementById('transactionCustomer').value;
                    const supplier = suppliers.find(s => s.name === supplierName);
                    if (supplier) {
                        supplier.totalOrders = (supplier.totalOrders || 0) + 1;
                        supplier.totalPurchases = (supplier.totalPurchases || 0) + transaction.amount;
                    }
                }
            }
            
            // Update customer stats if it's a sale
            if (type === 'sale') {
                const customerName = document.getElementById('transactionCustomer').value;
                const customer = customers.find(c => c.name === customerName);
                if (customer) {
                    customer.totalOrders = (customer.totalOrders || 0) + 1;
                    customer.totalSpent = (customer.totalSpent || 0) + transaction.amount;
                    customer.lastOrder = new Date().toISOString().split('T')[0];
                }
            }
            
            transactions.push(transaction);
            bootstrap.Modal.getInstance(document.getElementById('addTransactionModal')).hide();
            loadTransactions();
            loadDashboard();
            loadCustomers();
            loadSuppliers();
            saveToLocalStorage();
            showAlert('Transaction added successfully!', 'success');
        }
        
        function viewTransaction(transactionId) {
            const transaction = transactions.find(t => t.id === transactionId);
            if (transaction) {
                alert(`Transaction Details:\n\nDate: ${new Date(transaction.date).toLocaleString()}\nType: ${transaction.type}\nAmount: KES ${transaction.amount.toLocaleString()}\nCustomer/Supplier: ${transaction.customer || transaction.supplier || 'N/A'}\nDescription: ${transaction.description}\nPayment Method: ${transaction.paymentMethod}\nStatus: ${transaction.status}`);
            }
        }
        
        function deleteTransaction(transactionId) {
            if (confirm('Are you sure you want to delete this transaction? This action cannot be undone.')) {
                const index = transactions.findIndex(t => t.id === transactionId);
                if (index > -1) {
                    // If it's a sale, update customer stats
                    const transaction = transactions[index];
                    if (transaction.type === 'sale' && transaction.customer) {
                        const customer = customers.find(c => c.name === transaction.customer);
                        if (customer) {
                            customer.totalOrders = Math.max(0, (customer.totalOrders || 0) - 1);
                            customer.totalSpent = Math.max(0, (customer.totalSpent || 0) - transaction.amount);
                        }
                    }
                    
                    // If it's a purchase, update supplier stats
                    if (transaction.type === 'purchase' && transaction.supplier) {
                        const supplier = suppliers.find(s => s.name === transaction.supplier);
                        if (supplier) {
                            supplier.totalOrders = Math.max(0, (supplier.totalOrders || 0) - 1);
                            supplier.totalPurchases = Math.max(0, (supplier.totalPurchases || 0) - transaction.amount);
                        }
                    }
                    
                    transactions.splice(index, 1);
                    loadTransactions();
                    loadDashboard();
                    loadCustomers();
                    loadSuppliers();
                    saveToLocalStorage();
                    showAlert('Transaction deleted successfully!', 'success');
                }
            }
        }
        
        // SUPPLIERS FUNCTIONS - DYNAMIC AND EDITABLE
        function loadSuppliers() {
            const table = document.getElementById('suppliers-table');
            const container = document.getElementById('suppliers-table-container');
            const emptyState = document.getElementById('suppliers-empty-state');
            
            if (suppliers.length === 0) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }
            
            container.style.display = 'block';
            emptyState.style.display = 'none';
            table.innerHTML = '';
            
            // Update supplier stats
            const activeSuppliers = suppliers.filter(s => s.status === 'active' || s.status === 'preferred').length;
            const totalProductsSupplied = suppliers.reduce((sum, s) => sum + (s.products ? s.products.length : 0), 0);
            const totalPurchases = suppliers.reduce((sum, s) => sum + (s.totalPurchases || 0), 0);
            const avgDeliveryTime = suppliers.length > 0 ? 
                Math.round(suppliers.reduce((sum, s) => sum + (s.avgDeliveryTime || 0), 0) / suppliers.length) : 0;
            
            document.getElementById('total-active-suppliers').textContent = activeSuppliers;
            document.getElementById('total-products-supplied').textContent = totalProductsSupplied;
            document.getElementById('total-purchases').textContent = `KES ${totalPurchases.toLocaleString()}`;
            document.getElementById('avg-delivery-time').textContent = avgDeliveryTime;
            
            // Update sidebar count
            document.getElementById('supplier-count').textContent = activeSuppliers;
            
            suppliers.forEach(supplier => {
                const statusBadge = supplier.status === 'active' ? 
                    '<span class="badge bg-success">Active</span>' : 
                    supplier.status === 'preferred' ? 
                    '<span class="badge bg-warning">Preferred</span>' : 
                    supplier.status === 'inactive' ? 
                    '<span class="badge bg-secondary">Inactive</span>' : 
                    '<span class="badge bg-info">Pending</span>';
                
                const ratingStars = getRatingStars(supplier.rating || 3);
                const initials = supplier.name.split(' ').map(n => n[0]).join('').toUpperCase();
                
                // Limit displayed products to 3
                const displayedProducts = supplier.products ? supplier.products.slice(0, 3) : [];
                const extraProducts = supplier.products ? supplier.products.length - 3 : 0;
                
                const row = `
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="supplier-avatar me-3">
                                    ${initials.substring(0, 2)}
                                </div>
                                <div>
                                    <div class="fw-bold">${supplier.name}</div>
                                    <small class="text-muted">${supplier.type || 'Supplier'}</small>
                                </div>
                            </div>
                        </td>
                        <td>${supplier.contact}</td>
                        <td>
                            <div>${supplier.email}</div>
                            ${supplier.website ? `<small><a href="${supplier.website}" target="_blank">${supplier.website.replace('https://', '')}</a></small>` : ''}
                        </td>
                        <td>${supplier.phone}</td>
                        <td>
                            <div class="d-flex flex-wrap gap-1">
                                ${displayedProducts.map(product => `<span class="product-tag">${product}</span>`).join('')}
                                ${extraProducts > 0 ? `<span class="product-tag">+${extraProducts} more</span>` : ''}
                                ${(!supplier.products || supplier.products.length === 0) ? '<span class="text-muted small">No products</span>' : ''}
                            </div>
                        </td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                ${ratingStars}
                                <small class="ms-1">${supplier.rating || 3}/5</small>
                            </div>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="viewSupplier(${supplier.id})" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-warning" onclick="editSupplier(${supplier.id})" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteSupplier(${supplier.id})" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }
        
        function getRatingStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    stars += '<i class="fas fa-star text-warning"></i>';
                } else {
                    stars += '<i class="far fa-star text-muted"></i>';
                }
            }
            return stars;
        }
        
        function searchSuppliers() {
            const searchTerm = document.getElementById('supplierSearch').value.toLowerCase();
            const table = document.getElementById('suppliers-table');
            
            if (!searchTerm) {
                loadSuppliers();
                return;
            }
            
            const filteredSuppliers = suppliers.filter(supplier => 
                supplier.name.toLowerCase().includes(searchTerm) ||
                supplier.contact.toLowerCase().includes(searchTerm) ||
                supplier.email.toLowerCase().includes(searchTerm) ||
                supplier.phone.includes(searchTerm) ||
                (supplier.products && supplier.products.some(product => product.toLowerCase().includes(searchTerm))) ||
                (supplier.type && supplier.type.toLowerCase().includes(searchTerm))
            );
            
            if (filteredSuppliers.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-5">
                            <i class="fas fa-search fa-2x text-muted mb-3"></i>
                            <p class="text-muted">No suppliers found matching your search</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            table.innerHTML = '';
            
            filteredSuppliers.forEach(supplier => {
                const statusBadge = supplier.status === 'active' ? 
                    '<span class="badge bg-success">Active</span>' : 
                    supplier.status === 'preferred' ? 
                    '<span class="badge bg-warning">Preferred</span>' : 
                    supplier.status === 'inactive' ? 
                    '<span class="badge bg-secondary">Inactive</span>' : 
                    '<span class="badge bg-info">Pending</span>';
                
                const ratingStars = getRatingStars(supplier.rating || 3);
                const initials = supplier.name.split(' ').map(n => n[0]).join('').toUpperCase();
                
                // Limit displayed products to 3
                const displayedProducts = supplier.products ? supplier.products.slice(0, 3) : [];
                const extraProducts = supplier.products ? supplier.products.length - 3 : 0;
                
                const row = `
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="supplier-avatar me-3">
                                    ${initials.substring(0, 2)}
                                </div>
                                <div>
                                    <div class="fw-bold">${supplier.name}</div>
                                    <small class="text-muted">${supplier.type || 'Supplier'}</small>
                                </div>
                            </div>
                        </td>
                        <td>${supplier.contact}</td>
                        <td>
                            <div>${supplier.email}</div>
                            ${supplier.website ? `<small><a href="${supplier.website}" target="_blank">${supplier.website.replace('https://', '')}</a></small>` : ''}
                        </td>
                        <td>${supplier.phone}</td>
                        <td>
                            <div class="d-flex flex-wrap gap-1">
                                ${displayedProducts.map(product => `<span class="product-tag">${product}</span>`).join('')}
                                ${extraProducts > 0 ? `<span class="product-tag">+${extraProducts} more</span>` : ''}
                                ${(!supplier.products || supplier.products.length === 0) ? '<span class="text-muted small">No products</span>' : ''}
                            </div>
                        </td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                ${ratingStars}
                                <small class="ms-1">${supplier.rating || 3}/5</small>
                            </div>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="viewSupplier(${supplier.id})" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-warning" onclick="editSupplier(${supplier.id})" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteSupplier(${supplier.id})" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }
        
        function filterSuppliers(type) {
            let filtered = suppliers;
            if (type === 'active') {
                filtered = suppliers.filter(s => s.status === 'active');
            } else if (type === 'inactive') {
                filtered = suppliers.filter(s => s.status === 'inactive');
            } else if (type === 'preferred') {
                filtered = suppliers.filter(s => s.status === 'preferred');
            }
            
            const table = document.getElementById('suppliers-table');
            
            if (filtered.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-5">
                            <i class="fas fa-filter fa-2x text-muted mb-3"></i>
                            <p class="text-muted">No ${type} suppliers found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            table.innerHTML = '';
            
            filtered.forEach(supplier => {
                const statusBadge = supplier.status === 'active' ? 
                    '<span class="badge bg-success">Active</span>' : 
                    supplier.status === 'preferred' ? 
                    '<span class="badge bg-warning">Preferred</span>' : 
                    supplier.status === 'inactive' ? 
                    '<span class="badge bg-secondary">Inactive</span>' : 
                    '<span class="badge bg-info">Pending</span>';
                
                const ratingStars = getRatingStars(supplier.rating || 3);
                const initials = supplier.name.split(' ').map(n => n[0]).join('').toUpperCase();
                
                // Limit displayed products to 3
                const displayedProducts = supplier.products ? supplier.products.slice(0, 3) : [];
                const extraProducts = supplier.products ? supplier.products.length - 3 : 0;
                
                const row = `
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="supplier-avatar me-3">
                                    ${initials.substring(0, 2)}
                                </div>
                                <div>
                                    <div class="fw-bold">${supplier.name}</div>
                                    <small class="text-muted">${supplier.type || 'Supplier'}</small>
                                </div>
                            </div>
                        </td>
                        <td>${supplier.contact}</td>
                        <td>
                            <div>${supplier.email}</div>
                            ${supplier.website ? `<small><a href="${supplier.website}" target="_blank">${supplier.website.replace('https://', '')}</a></small>` : ''}
                        </td>
                        <td>${supplier.phone}</td>
                        <td>
                            <div class="d-flex flex-wrap gap-1">
                                ${displayedProducts.map(product => `<span class="product-tag">${product}</span>`).join('')}
                                ${extraProducts > 0 ? `<span class="product-tag">+${extraProducts} more</span>` : ''}
                                ${(!supplier.products || supplier.products.length === 0) ? '<span class="text-muted small">No products</span>' : ''}
                            </div>
                        </td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                ${ratingStars}
                                <small class="ms-1">${supplier.rating || 3}/5</small>
                            </div>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="viewSupplier(${supplier.id})" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-warning" onclick="editSupplier(${supplier.id})" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteSupplier(${supplier.id})" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }
        
        function showAddSupplierModal() {
            // Reset form and product tags
            document.getElementById('supplierForm').reset();
            document.getElementById('supplierModalTitle').textContent = 'Add New Supplier';
            document.getElementById('supplierId').value = '';
            supplierProductTags = [];
            renderProductTags();
            
            // Set default values
            document.getElementById('supplierCountry').value = 'Kenya';
            document.getElementById('supplierPaymentTerms').value = 30;
            document.getElementById('supplierRating').value = 3;
            document.getElementById('supplierStatus').value = 'active';
            document.getElementById('supplierType').value = 'Distributor';
            
            // Show modal
            new bootstrap.Modal(document.getElementById('addSupplierModal')).show();
        }
        
        function addProductTag() {
            const input = document.getElementById('newProductInput');
            const product = input.value.trim();
            
            if (product && !supplierProductTags.includes(product)) {
                supplierProductTags.push(product);
                renderProductTags();
                input.value = '';
                input.focus();
            }
        }
        
        function removeProductTag(index) {
            supplierProductTags.splice(index, 1);
            renderProductTags();
        }
        
        function renderProductTags() {
            const container = document.getElementById('productTagsContainer');
            container.innerHTML = '';
            
            supplierProductTags.forEach((product, index) => {
                const tag = document.createElement('div');
                tag.className = 'product-tag';
                tag.innerHTML = `
                    ${product}
                    <button type="button" class="btn-close btn-close-sm ms-1" onclick="removeProductTag(${index})" style="font-size: 0.7rem;"></button>
                `;
                container.appendChild(tag);
            });
        }
        
        function saveSupplier() {
            const supplierId = document.getElementById('supplierId').value;
            const supplier = {
                id: supplierId ? parseInt(supplierId) : (suppliers.length > 0 ? Math.max(...suppliers.map(s => s.id)) + 1 : 1),
                name: document.getElementById('supplierName').value,
                contact: document.getElementById('supplierContact').value,
                email: document.getElementById('supplierEmail').value,
                phone: document.getElementById('supplierPhone').value,
                website: document.getElementById('supplierWebsite').value,
                type: document.getElementById('supplierType').value,
                products: [...supplierProductTags],
                address: document.getElementById('supplierAddress').value,
                city: document.getElementById('supplierCity').value,
                country: document.getElementById('supplierCountry').value,
                paymentTerms: parseInt(document.getElementById('supplierPaymentTerms').value),
                rating: parseInt(document.getElementById('supplierRating').value),
                status: document.getElementById('supplierStatus').value,
                notes: document.getElementById('supplierNotes').value,
                joinDate: supplierId ? suppliers.find(s => s.id === parseInt(supplierId))?.joinDate || new Date().toISOString().split('T')[0] : new Date().toISOString().split('T')[0]
            };
            
            // If editing, preserve purchase history
            if (supplierId) {
                const existingSupplier = suppliers.find(s => s.id === parseInt(supplierId));
                if (existingSupplier) {
                    supplier.totalPurchases = existingSupplier.totalPurchases || 0;
                    supplier.totalOrders = existingSupplier.totalOrders || 0;
                    supplier.avgDeliveryTime = existingSupplier.avgDeliveryTime || 0;
                }
            } else {
                // New supplier
                supplier.totalPurchases = 0;
                supplier.totalOrders = 0;
                supplier.avgDeliveryTime = 0;
            }
            
            if (supplierId) {
                // Update existing supplier
                const index = suppliers.findIndex(s => s.id === parseInt(supplierId));
                if (index !== -1) {
                    suppliers[index] = supplier;
                    showAlert('Supplier updated successfully!', 'success');
                }
            } else {
                // Add new supplier
                suppliers.push(supplier);
                showAlert('Supplier added successfully!', 'success');
            }
            
            // Update product dropdowns with new supplier
            updateSupplierDropdowns();
            
            // Close modal and reload suppliers
            bootstrap.Modal.getInstance(document.getElementById('addSupplierModal')).hide();
            loadSuppliers();
            loadDashboard();
            saveToLocalStorage();
        }
        
        function editSupplier(supplierId) {
            const supplier = suppliers.find(s => s.id === supplierId);
            if (supplier) {
                // Populate form
                document.getElementById('supplierId').value = supplier.id;
                document.getElementById('supplierName').value = supplier.name;
                document.getElementById('supplierContact').value = supplier.contact;
                document.getElementById('supplierEmail').value = supplier.email;
                document.getElementById('supplierPhone').value = supplier.phone;
                document.getElementById('supplierWebsite').value = supplier.website || '';
                document.getElementById('supplierType').value = supplier.type || 'Distributor';
                document.getElementById('supplierAddress').value = supplier.address || '';
                document.getElementById('supplierCity').value = supplier.city || '';
                document.getElementById('supplierCountry').value = supplier.country || 'Kenya';
                document.getElementById('supplierPaymentTerms').value = supplier.paymentTerms || 30;
                document.getElementById('supplierRating').value = supplier.rating || 3;
                document.getElementById('supplierStatus').value = supplier.status || 'active';
                document.getElementById('supplierNotes').value = supplier.notes || '';
                
                // Set product tags
                supplierProductTags = supplier.products || [];
                renderProductTags();
                
                // Update modal title
                document.getElementById('supplierModalTitle').textContent = 'Edit Supplier';
                
                // Show modal
                new bootstrap.Modal(document.getElementById('addSupplierModal')).show();
            }
        }
        
        function viewSupplier(supplierId) {
            const supplier = suppliers.find(s => s.id === supplierId);
            if (supplier) {
                const modalContent = `
                    <div class="row">
                        <div class="col-md-4 text-center mb-3">
                            <div class="supplier-avatar mx-auto" style="width: 80px; height: 80px; font-size: 1.8rem;">
                                ${supplier.name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2)}
                            </div>
                            <h5 class="mt-3">${supplier.name}</h5>
                            <span class="badge ${supplier.status === 'active' ? 'bg-success' : supplier.status === 'preferred' ? 'bg-warning' : 'bg-secondary'}">${supplier.status}</span>
                        </div>
                        <div class="col-md-8">
                            <table class="table table-sm">
                                <tr><th>Contact Person:</th><td>${supplier.contact}</td></tr>
                                <tr><th>Email:</th><td><a href="mailto:${supplier.email}">${supplier.email}</a></td></tr>
                                <tr><th>Phone:</th><td>${supplier.phone}</td></tr>
                                ${supplier.website ? `<tr><th>Website:</th><td><a href="${supplier.website}" target="_blank">${supplier.website}</a></td></tr>` : ''}
                                <tr><th>Type:</th><td>${supplier.type}</td></tr>
                                <tr><th>Address:</th><td>${supplier.address || 'N/A'}, ${supplier.city || ''}, ${supplier.country || ''}</td></tr>
                                <tr><th>Payment Terms:</th><td>${supplier.paymentTerms || 30} days</td></tr>
                                <tr><th>Rating:</th><td>${getRatingStars(supplier.rating || 3)} (${supplier.rating || 3}/5)</td></tr>
                                <tr><th>Total Purchases:</th><td>KES ${(supplier.totalPurchases || 0).toLocaleString()}</td></tr>
                                <tr><th>Total Orders:</th><td>${supplier.totalOrders || 0}</td></tr>
                                <tr><th>Avg Delivery Time:</th><td>${supplier.avgDeliveryTime || 0} days</td></tr>
                                <tr><th>Products:</th><td>${supplier.products ? supplier.products.join(', ') : 'None'}</td></tr>
                                ${supplier.notes ? `<tr><th>Notes:</th><td>${supplier.notes}</td></tr>` : ''}
                            </table>
                        </div>
                    </div>
                `;
                
                // Create a custom modal for viewing
                const modal = `
                    <div class="modal fade" id="viewSupplierModal" tabindex="-1">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Supplier Details</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    ${modalContent}
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" onclick="editSupplier(${supplierId})">Edit Supplier</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Remove existing modal if any
                const existingModal = document.getElementById('viewSupplierModal');
                if (existingModal) existingModal.remove();
                
                // Add modal to DOM and show it
                document.body.insertAdjacentHTML('beforeend', modal);
                new bootstrap.Modal(document.getElementById('viewSupplierModal')).show();
            }
        }
        
        function deleteSupplier(supplierId) {
            const supplier = suppliers.find(s => s.id === supplierId);
            if (!supplier) return;
            
            // Check if any products are linked to this supplier
            const linkedProducts = products.filter(p => p.supplier === supplier.name);
            
            if (linkedProducts.length > 0) {
                const productList = linkedProducts.map(p => ` ${p.name}`).join('\n');
                if (!confirm(`This supplier has ${linkedProducts.length} product(s) linked to it:\n\n${productList}\n\nAre you sure you want to delete this supplier? This will set those products' supplier to "Unknown".`)) {
                    return;
                }
                
                // Update products to remove supplier reference
                linkedProducts.forEach(product => {
                    product.supplier = 'Unknown';
                });
            } else if (!confirm('Are you sure you want to delete this supplier? This action cannot be undone.')) {
                return;
            }
            
            const index = suppliers.findIndex(s => s.id === supplierId);
            if (index > -1) {
                suppliers.splice(index, 1);
                loadSuppliers();
                loadDashboard();
                saveToLocalStorage();
                showAlert('Supplier deleted successfully!', 'success');
            }
        }
        
        function updateSupplierDropdowns() {
            // Update supplier dropdown in product modal
            const productSupplierSelect = document.getElementById('productSupplier');
            if (productSupplierSelect) {
                productSupplierSelect.innerHTML = '<option value="">Select Supplier</option>' +
                    suppliers.map(s => `<option value="${s.name}">${s.name}</option>`).join('');
            }
        }
        
        function exportSuppliers() {
            if (suppliers.length === 0) {
                showAlert('No suppliers to export', 'warning');
                return;
            }
            
            const dataStr = JSON.stringify(suppliers, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportFileDefaultName = `suppliers_export_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showAlert('Suppliers exported successfully!', 'success');
        }
        
        function generateSupplierReport() {
            if (suppliers.length === 0) {
                showAlert('No suppliers data available for report', 'warning');
                return;
            }
            
            const reportData = {
                totalSuppliers: suppliers.length,
                activeSuppliers: suppliers.filter(s => s.status === 'active' || s.status === 'preferred').length,
                totalPurchases: suppliers.reduce((sum, s) => sum + (s.totalPurchases || 0), 0),
                topSuppliers: suppliers.sort((a, b) => (b.totalPurchases || 0) - (a.totalPurchases || 0)).slice(0, 5),
                supplierTypes: {}
            };
            
            // Count supplier types
            suppliers.forEach(supplier => {
                reportData.supplierTypes[supplier.type] = (reportData.supplierTypes[supplier.type] || 0) + 1;
            });
            
            // Create report content
            let reportContent = `SUPPLIER REPORT - ${new Date().toLocaleDateString()}\n`;
            reportContent += `========================================\n\n`;
            reportContent += `Total Suppliers: ${reportData.totalSuppliers}\n`;
            reportContent += `Active Suppliers: ${reportData.activeSuppliers}\n`;
            reportContent += `Total Purchases: KES ${reportData.totalPurchases.toLocaleString()}\n\n`;
            reportContent += `TOP 5 SUPPLIERS BY PURCHASE VALUE:\n`;
            reportContent += `----------------------------------------\n`;
            
            reportData.topSuppliers.forEach((supplier, index) => {
                reportContent += `${index + 1}. ${supplier.name}\n`;
                reportContent += `   Purchases: KES ${(supplier.totalPurchases || 0).toLocaleString()}\n`;
                reportContent += `   Orders: ${supplier.totalOrders || 0}\n`;
                reportContent += `   Rating: ${supplier.rating || 3}/5\n\n`;
            });
            
            // Show report in alert and console
            alert('Supplier report generated! Check the console for details.');
            console.log('Supplier Report:', reportData);
            console.log('Full Report:\n' + reportContent);
            
            // Option to download as text file
            if (confirm('Would you like to download this report as a text file?')) {
                const dataUri = 'data:text/plain;charset=utf-8,' + encodeURIComponent(reportContent);
                const exportFileDefaultName = `supplier_report_${new Date().toISOString().split('T')[0]}.txt`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            }
        }
        
        // Notes Functions
        function loadNotes() {
            const container = document.getElementById('notes-container');
            const emptyState = document.getElementById('notes-empty-state');
            
            if (notes.length === 0) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }
            
            container.style.display = 'block';
            emptyState.style.display = 'none';
            container.innerHTML = '';
            
            notes.forEach(note => {
                const priorityClass = note.priority === 'high' ? 'border-danger' : 
                                    note.priority === 'medium' ? 'border-warning' : 'border-info';
                
                const col = document.createElement('div');
                col.className = 'col-md-4 mb-4';
                col.innerHTML = `
                    <div class="note-card ${priorityClass}">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div class="note-title">${note.title}</div>
                            <span class="badge bg-secondary">${note.category}</span>
                        </div>
                        <div class="note-content">${note.content}</div>
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <div class="note-date text-muted small">
                                <i class="far fa-calendar me-1"></i>${new Date(note.date).toLocaleDateString()}
                            </div>
                            <div>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteNote(${note.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(col);
            });
        }
        
        function showAddNoteModal() {
            document.getElementById('noteForm').reset();
            new bootstrap.Modal(document.getElementById('addNoteModal')).show();
        }
        
        function saveNote() {
            const note = {
                id: notes.length > 0 ? Math.max(...notes.map(n => n.id)) + 1 : 1,
                title: document.getElementById('noteTitle').value,
                content: document.getElementById('noteContent').value,
                category: document.getElementById('noteCategory').value,
                date: new Date().toISOString().split('T')[0],
                priority: 'medium'
            };
            
            notes.push(note);
            bootstrap.Modal.getInstance(document.getElementById('addNoteModal')).hide();
            loadNotes();
            saveToLocalStorage();
            showAlert('Note added successfully!', 'success');
        }
        
        function deleteNote(noteId) {
            if (confirm('Are you sure you want to delete this note?')) {
                const index = notes.findIndex(n => n.id === noteId);
                if (index > -1) {
                    notes.splice(index, 1);
                    loadNotes();
                    saveToLocalStorage();
                    showAlert('Note deleted successfully!', 'success');
                }
            }
        }
        
        // DATA CLEARING AND RESET FUNCTIONS
        function resetAllData() {
            if (!confirm('WARNING: This will permanently delete ALL data including products, customers, transactions, suppliers, and notes. This action cannot be undone!\n\nAre you absolutely sure you want to reset ALL data?')) {
                return;
            }
            
            // Double confirmation for safety
            if (!confirm('FINAL WARNING: This will delete everything and cannot be recovered. Type "DELETE ALL" to confirm.')) {
                const userInput = prompt('Type "DELETE ALL" to confirm resetting all data:');
                if (userInput !== 'DELETE ALL') {
                    showAlert('Data reset cancelled', 'info');
                    return;
                }
            }
            
            // Clear all data arrays
            products = [];
            customers = [];
            transactions = [];
            suppliers = [];
            notes = [];
            
            // Clear localStorage
            localStorage.removeItem('businessSuiteData');
            localStorage.removeItem('businessSuiteFirstRun');
            
            // Reload all sections
            loadDashboard();
            loadProducts();
            loadCustomers();
            loadTransactions();
            loadSuppliers();
            loadNotes();
            
            showAlert('ALL data has been permanently deleted. The system is now empty.', 'danger');
        }
        
        function clearSpecificData() {
            // Show modal for selecting what to clear
            document.getElementById('clearProducts').checked = false;
            document.getElementById('clearCustomers').checked = false;
            document.getElementById('clearTransactions').checked = false;
            document.getElementById('clearSuppliers').checked = false;
            document.getElementById('clearNotes').checked = false;
            
            new bootstrap.Modal(document.getElementById('clearDataModal')).show();
        }
        
        function executeClearData() {
            const clearProducts = document.getElementById('clearProducts').checked;
            const clearCustomers = document.getElementById('clearCustomers').checked;
            const clearTransactions = document.getElementById('clearTransactions').checked;
            const clearSuppliers = document.getElementById('clearSuppliers').checked;
            const clearNotes = document.getElementById('clearNotes').checked;
            
            if (!clearProducts && !clearCustomers && !clearTransactions && !clearSuppliers && !clearNotes) {
                showAlert('Please select at least one data type to clear', 'warning');
                return;
            }
            
            if (!confirm('WARNING: This will permanently delete the selected data. This action cannot be undone!\n\nAre you sure you want to continue?')) {
                return;
            }
            
            let clearedItems = [];
            
            if (clearProducts) {
                products = [];
                clearedItems.push('Products');
            }
            
            if (clearCustomers) {
                customers = [];
                clearedItems.push('Customers');
            }
            
            if (clearTransactions) {
                transactions = [];
                clearedItems.push('Transactions');
            }
            
            if (clearSuppliers) {
                suppliers = [];
                clearedItems.push('Suppliers');
            }
            
            if (clearNotes) {
                notes = [];
                clearedItems.push('Notes');
            }
            
            // Save to localStorage
            saveToLocalStorage();
            
            // Reload all sections
            loadDashboard();
            loadProducts();
            loadCustomers();
            loadTransactions();
            loadSuppliers();
            loadNotes();
            
            bootstrap.Modal.getInstance(document.getElementById('clearDataModal')).hide();
            showAlert(`Cleared: ${clearedItems.join(', ')}`, 'success');
        }
        
        function loadSampleData() {
            if (!confirm('This will load sample data for testing purposes. Your current data will be replaced.\n\nAre you sure you want to load sample data?')) {
                return;
            }
            
            // Load sample data
            products = [...sampleData.products];
            customers = [...sampleData.customers];
            transactions = [...sampleData.transactions];
            suppliers = [...sampleData.suppliers];
            notes = [...sampleData.notes];
            
            // Save to localStorage
            saveToLocalStorage();
            
            // Reload all sections
            loadDashboard();
            loadProducts();
            loadCustomers();
            loadTransactions();
            loadSuppliers();
            loadNotes();
            
            showAlert('Sample data loaded successfully! You can now explore the system features.', 'info');
        }
        
        function showQuickStartGuide() {
            const guide = `
                <div class="modal fade" id="quickStartModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Quick Start Guide</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <h6>Getting Started with Business Suite Pro</h6>
                                <ol class="mb-3">
                                    <li><strong>Start with Suppliers</strong> - Add your suppliers first</li>
                                    <li><strong>Add Products</strong> - Add products with supplier information</li>
                                    <li><strong>Add Customers</strong> - Create your customer database</li>
                                    <li><strong>Record Transactions</strong> - Add sales and purchases</li>
                                    <li><strong>Use Analytics</strong> - View business performance</li>
                                </ol>
                                
                                <h6>Data Management</h6>
                                <ul class="mb-3">
                                    <li>Your data is automatically saved in your browser</li>
                                    <li>Export data regularly for backup</li>
                                    <li>Use the "Reset All Data" option carefully</li>
                                    <li>Load sample data to explore features</li>
                                </ul>
                                
                                <div class="alert alert-info">
                                    <i class="fas fa-lightbulb"></i> <strong>Tip:</strong> The system starts completely empty. Add your real business data to get accurate reports and analytics.
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" onclick="loadSampleData(); bootstrap.Modal.getInstance(document.getElementById('quickStartModal')).hide();">Load Sample Data</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing modal if any
            const existingModal = document.getElementById('quickStartModal');
            if (existingModal) existingModal.remove();
            
            // Add modal to DOM and show it
            document.body.insertAdjacentHTML('beforeend', guide);
            new bootstrap.Modal(document.getElementById('quickStartModal')).show();
        }
        
        // Export Functions
        function exportProducts() {
            if (products.length === 0) {
                showAlert('No products to export', 'warning');
                return;
            }
            
            const dataStr = JSON.stringify(products, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportFileDefaultName = `products_export_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showAlert('Products exported successfully!', 'success');
        }
        
        function exportCustomers() {
            if (customers.length === 0) {
                showAlert('No customers to export', 'warning');
                return;
            }
            
            const dataStr = JSON.stringify(customers, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportFileDefaultName = `customers_export_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showAlert('Customers exported successfully!', 'success');
        }
        
        function exportTransactions() {
            if (transactions.length === 0) {
                showAlert('No transactions to export', 'warning');
                return;
            }
            
            const dataStr = JSON.stringify(transactions, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportFileDefaultName = `transactions_export_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showAlert('Transactions exported successfully!', 'success');
        }
        
        function exportData() {
            const allData = {
                products: products,
                customers: customers,
                transactions: transactions,
                suppliers: suppliers,
                notes: notes,
                exportDate: new Date().toISOString()
            };
            
            if (products.length === 0 && customers.length === 0 && transactions.length === 0 && suppliers.length === 0 && notes.length === 0) {
                showAlert('No data to export', 'warning');
                return;
            }
            
            const dataStr = JSON.stringify(allData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportFileDefaultName = `business_backup_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showAlert('All data exported successfully!', 'success');
        }
        
        function backupData() {
            exportData(); // Uses the same function for simplicity
        }
        
        function restoreData() {
            const fileInput = document.getElementById('restoreFile');
            if (!fileInput.files.length) {
                showAlert('Please select a backup file to restore', 'warning');
                return;
            }
            
            if (!confirm('WARNING: This will replace all current data with backup data. Current data will be lost.\n\nAre you sure you want to continue?')) {
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    // Restore data
                    if (backupData.products) products = backupData.products;
                    if (backupData.customers) customers = backupData.customers;
                    if (backupData.transactions) transactions = backupData.transactions;
                    if (backupData.suppliers) suppliers = backupData.suppliers;
                    if (backupData.notes) notes = backupData.notes;
                    
                    // Save to localStorage
                    saveToLocalStorage();
                    
                    // Reload all sections
                    loadDashboard();
                    loadProducts();
                    loadCustomers();
                    loadTransactions();
                    loadSuppliers();
                    loadNotes();
                    
                    fileInput.value = '';
                    showAlert('Data restored successfully from backup!', 'success');
                } catch (error) {
                    console.error('Error restoring data:', error);
                    showAlert('Error: Invalid backup file format. Please select a valid JSON backup file.', 'danger');
                }
            };
            
            reader.readAsText(file);
        }
        
        // Report Functions
        function generateSalesReport() {
            if (transactions.filter(t => t.type === 'sale').length === 0) {
                showAlert('No sales data available for report', 'warning');
                return;
            }
            
            const reportData = {
                totalSales: transactions.filter(t => t.type === 'sale').reduce((sum, t) => sum + t.amount, 0),
                totalTransactions: transactions.filter(t => t.type === 'sale').length,
                averageSale: transactions.filter(t => t.type === 'sale').reduce((sum, t) => sum + t.amount, 0) / transactions.filter(t => t.type === 'sale').length
            };
            
            alert(`Sales Report:\n\nTotal Sales: KES ${reportData.totalSales.toLocaleString()}\nTotal Transactions: ${reportData.totalTransactions}\nAverage Sale: KES ${reportData.averageSale.toFixed(2).toLocaleString()}`);
        }
        
        function generateInventoryReport() {
            if (products.length === 0) {
                showAlert('No inventory data available for report', 'warning');
                return;
            }
            
            const reportData = {
                totalProducts: products.length,
                totalStockValue: products.reduce((sum, p) => sum + (p.price * p.stock), 0),
                lowStockItems: products.filter(p => p.stock <= (p.minStock || 5) && p.stock > 0).length,
                outOfStockItems: products.filter(p => p.stock <= 0).length
            };
            
            alert(`Inventory Report:\n\nTotal Products: ${reportData.totalProducts}\nTotal Stock Value: KES ${reportData.totalStockValue.toLocaleString()}\nLow Stock Items: ${reportData.lowStockItems}\nOut of Stock Items: ${reportData.outOfStockItems}`);
        }
        
        // Utility Functions
        function refreshDashboard() {
            loadDashboard();
            showAlert('Dashboard refreshed successfully!', 'info');
        }
        
        function showAlert(message, type) {
            // Remove existing alerts
            document.querySelectorAll('.alert-box').forEach(alert => alert.remove());
            
            // Create alert element
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show alert-box`;
            alertDiv.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'danger' ? 'fa-exclamation-circle' : type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle'} me-2"></i>
                    <div>${message}</div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(alertDiv);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.classList.remove('show');
                    setTimeout(() => {
                        if (alertDiv.parentNode) {
                            alertDiv.parentNode.removeChild(alertDiv);
                        }
                    }, 300);
                }
            }, 5000);
        }
        
        function changeChartPeriod(period) {
            // Update button states
            document.querySelectorAll('#salesChart + .btn-group .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            showAlert(`Chart period changed to ${period}`, 'info');
        }
        
        function exportAnalytics() {
            showAlert('Analytics report exported successfully!', 'success');
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl + S for save
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                if (currentSection === 'products') {
                    showAddProductModal();
                } else if (currentSection === 'customers') {
                    showAddCustomerModal();
                } else if (currentSection === 'transactions') {
                    showAddTransactionModal();
                } else if (currentSection === 'suppliers') {
                    showAddSupplierModal();
                } else if (currentSection === 'notes') {
                    showAddNoteModal();
                }
            }
            
            // Ctrl + R for refresh
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                refreshDashboard();
            }
            
            // Ctrl + E for export
            if (e.ctrlKey && e.key === 'e') {
                e.preventDefault();
                exportData();
            }
            
            // Ctrl + D for delete all (with confirmation)
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                if (confirm('Press OK to reset all data (this cannot be undone)')) {
                    resetAllData();
                }
            }
        });
    </script>
</body>
</html>
